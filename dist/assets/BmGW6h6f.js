import{j as e,m as r,A,i as E,r as M,e as _,U,X as $,Z as g}from"./DUqNHp0R.js";import{u as O,r as l}from"./gFfKhp4p.js";import{B as R}from"./C8P6TVrj.js";import{u as q,m as c,s as z,a as B}from"./CVbp4Owk.js";import{g as F}from"./BSdRGNX3.js";import"./DqliOerU.js";function H({mode:m,category:o,onCancel:v,onMatchFound:y}){var f,b;const{user:n,profile:t}=q();O();const[x,h]=l.useState("searching"),[N,w]=l.useState(0),[d,S]=l.useState(null),[p,I]=l.useState("");l.useEffect(()=>{const a=setInterval(()=>{I(s=>s.length>=3?"":s+".")},500);return()=>clearInterval(a)},[]),l.useEffect(()=>{const a=setInterval(()=>{w(s=>s+1)},1e3);return()=>clearInterval(a)},[]),l.useEffect(()=>{if(!n||!t)return;let a,s;return(async()=>{try{await c.joinQueue(n.id,m,o,t.league_points||1e3),s=setInterval(async()=>{const i=await c.findOpponent(n.id,m,t.league_points||1e3);if(i){clearInterval(s),h("found");const{data:u}=await z.from("profiles").select("*").eq("id",i.user_id).single();S(u);const Q=F(o||"culture",10),T=await B.createSoloGame(n.id,o||"culture",Q);await c.leaveQueue(n.id),await c.leaveQueue(i.user_id),setTimeout(()=>{h("connecting"),setTimeout(()=>{y(T.id,(u==null?void 0:u.username)||"Adversaire")},1500)},2e3)}},2e3),a=c.subscribeToQueue(i=>{console.log("Queue update:",i)})}catch(i){console.error("Erreur matchmaking:",i)}})(),()=>{s&&clearInterval(s),a&&a.unsubscribe(),c.leaveQueue(n.id)}},[n,t,m,o]);const k=async()=>{n&&await c.leaveQueue(n.id),v()},C=a=>{const s=Math.floor(a/60),j=a%60;return`${s}:${j.toString().padStart(2,"0")}`};return e.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/90 backdrop-blur-xl z-50 flex items-center justify-center p-4",children:e.jsx(r.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-gray-900/80 border border-cyan-500/30 rounded-2xl p-8 max-w-md w-full text-center",children:e.jsxs(A,{mode:"wait",children:[x==="searching"&&e.jsxs(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsxs("div",{className:"relative w-32 h-32 mx-auto mb-6",children:[e.jsx(r.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"absolute inset-0 rounded-full border-4 border-transparent border-t-cyan-500 border-r-purple-500"}),e.jsx(r.div,{animate:{rotate:-360},transition:{duration:3,repeat:1/0,ease:"linear"},className:"absolute inset-4 rounded-full border-4 border-transparent border-b-cyan-400 border-l-purple-400"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(E,{className:"w-12 h-12 text-cyan-400"})})]}),e.jsxs("h2",{className:"text-2xl font-bold text-white mb-2",children:["Recherche d'adversaire",p]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-400 mb-6",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{children:C(N)})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Mode"}),e.jsx("span",{className:"text-white font-semibold flex items-center gap-2",children:m==="ranked"?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4 text-yellow-500"}),"Classé"]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 text-cyan-400"}),"Aléatoire"]})})]}),o&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"text-gray-400",children:"Catégorie"}),e.jsx("span",{className:"text-white font-semibold capitalize",children:o})]})]}),e.jsxs(R,{onClick:k,variant:"outline",className:"border-red-500/50 text-red-400 hover:bg-red-500/10",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Annuler"]})]},"searching"),x==="found"&&d&&e.jsxs(r.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},children:[e.jsx(r.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",damping:10},className:"w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center",children:e.jsx(g,{className:"w-10 h-10 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-green-400 mb-4",children:"Adversaire trouvé !"}),e.jsxs("div",{className:"flex items-center justify-center gap-8 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`w-16 h-16 rounded-full bg-gradient-to-br ${(t==null?void 0:t.avatar_color)||"from-cyan-500 to-blue-600"} flex items-center justify-center text-white font-bold text-xl mb-2`,children:((f=t==null?void 0:t.username)==null?void 0:f.substring(0,2).toUpperCase())||"ME"}),e.jsx("p",{className:"text-white font-semibold",children:(t==null?void 0:t.username)||"Toi"}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["Niv. ",(t==null?void 0:t.level)||1]})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-500",children:"VS"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`w-16 h-16 rounded-full bg-gradient-to-br ${d.avatar_color||"from-red-500 to-orange-600"} flex items-center justify-center text-white font-bold text-xl mb-2`,children:((b=d.username)==null?void 0:b.substring(0,2).toUpperCase())||"OP"}),e.jsx("p",{className:"text-white font-semibold",children:d.username}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["Niv. ",d.level||1]})]})]})]},"found"),x==="connecting"&&e.jsxs(r.div,{initial:{opacity:0},animate:{opacity:1},children:[e.jsx(r.div,{animate:{scale:[1,1.1,1]},transition:{duration:.5,repeat:1/0},className:"w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-cyan-500 to-purple-600 flex items-center justify-center",children:e.jsx(g,{className:"w-10 h-10 text-white"})}),e.jsxs("h2",{className:"text-2xl font-bold text-white mb-2",children:["Connexion en cours",p]}),e.jsx("p",{className:"text-gray-400",children:"Préparation de la partie"})]},"connecting")]})})})}export{H as default};
