import{s as e}from"./BjEl9CBU.js";const a={async getFeed(a=20,t=0){const{data:r,error:n}=await e.from("posts").select("\n        *,\n        user:profiles!posts_user_id_fkey(id, username, avatar_url, avatar_color, level, league),\n        opponent:profiles!posts_opponent_id_fkey(id, username, avatar_url, avatar_color)\n      ").eq("is_public",!0).order("created_at",{ascending:!1}).range(t,t+a-1);if(n)throw n;return r||[]},async getUserFeed(a,t=20){const{data:r,error:n}=await e.from("posts").select("\n        *,\n        user:profiles!posts_user_id_fkey(id, username, avatar_url, avatar_color, level, league),\n        opponent:profiles!posts_opponent_id_fkey(id, username, avatar_url, avatar_color)\n      ").eq("user_id",a).order("created_at",{ascending:!1}).limit(t);if(n)throw n;return r||[]},async postQuizResult(a,t,r,n,s,o){const{data:i,error:c}=await e.from("posts").insert({user_id:a,type:"result",category:t,score:r,is_victory:n,opponent_id:s,opponent_score:o}).select().single();if(c)throw c;return i},async postAchievement(a,t){const{data:r,error:n}=await e.from("posts").insert({user_id:a,type:"achievement",achievement_id:t}).select().single();if(n)throw n;return r},async postLevelUp(a,t){const{data:r,error:n}=await e.from("posts").insert({user_id:a,type:"level_up",new_level:t}).select().single();if(n)throw n;return r},async postLeagueUp(a,t){const{data:r,error:n}=await e.from("posts").insert({user_id:a,type:"league_up",new_league:t}).select().single();if(n)throw n;return r},async createChallenge(a,t,r="medium",n){const{data:s,error:o}=await e.from("challenges").insert({challenger_id:a,challenged_id:n,category:t,difficulty:r}).select().single();if(o)throw o;return await e.from("posts").insert({user_id:a,type:"challenge",challenge_category:t,challenge_difficulty:r}),s},async likePost(a,t){const{error:r}=await e.from("post_likes").insert({post_id:a,user_id:t});if(r&&!r.message.includes("duplicate"))throw r},async unlikePost(a,t){const{error:r}=await e.from("post_likes").delete().eq("post_id",a).eq("user_id",t);if(r)throw r},async isPostLiked(a,t){const{data:r}=await e.from("post_likes").select("id").eq("post_id",a).eq("user_id",t).single();return!!r},async getComments(a){const{data:t,error:r}=await e.from("post_comments").select("\n        *,\n        user:profiles(id, username, avatar_url, avatar_color)\n      ").eq("post_id",a).order("created_at",{ascending:!0});if(r)throw r;return t||[]},async addComment(a,t,r){const{data:n,error:s}=await e.from("post_comments").insert({post_id:a,user_id:t,content:r}).select("\n        *,\n        user:profiles(id, username, avatar_url, avatar_color)\n      ").single();if(s)throw s;return n},async deleteComment(a){const{error:t}=await e.from("post_comments").delete().eq("id",a);if(t)throw t}},t={async getNotifications(a,t=50){const{data:r,error:n}=await e.from("notifications").select("\n        *,\n        from_user:profiles!notifications_from_user_id_fkey(id, username, avatar_url, avatar_color)\n      ").eq("user_id",a).order("created_at",{ascending:!1}).limit(t);if(n)throw n;return r||[]},async getUnreadCount(a){const{count:t,error:r}=await e.from("notifications").select("*",{count:"exact",head:!0}).eq("user_id",a).eq("is_read",!1);if(r)throw r;return t||0},async markAsRead(a){const{error:t}=await e.from("notifications").update({is_read:!0}).eq("id",a);if(t)throw t},async markAllAsRead(a){const{error:t}=await e.from("notifications").update({is_read:!0}).eq("user_id",a).eq("is_read",!1);if(t)throw t},subscribeToNotifications:(a,t)=>e.channel(`notifications_${a}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${a}`},e=>t(e.new)).subscribe()},r={async getPublicChallenges(a=20){const{data:t,error:r}=await e.from("challenges").select("\n        *,\n        challenger:profiles!challenges_challenger_id_fkey(id, username, avatar_url, avatar_color, level)\n      ").is("challenged_id",null).eq("status","pending").gt("expires_at",(new Date).toISOString()).order("created_at",{ascending:!1}).limit(a);if(r)throw r;return t||[]},async acceptChallenge(a,t){const{error:r}=await e.from("challenges").update({challenged_id:t,status:"accepted"}).eq("id",a).is("challenged_id",null);if(r)throw r},async completeChallenge(a,t,r){const{data:n}=await e.from("challenges").select("challenger_id, challenged_id").eq("id",a).single();if(!n)return;const{error:s}=await e.from("challenges").update({status:"completed",challenger_score:t,challenged_score:r,winner_id:t>r?n.challenger_id:n.challenged_id,completed_at:(new Date).toISOString()}).eq("id",a);if(s)throw s},async getMyChallenges(a){const{data:t,error:r}=await e.from("challenges").select("\n        *,\n        challenger:profiles!challenges_challenger_id_fkey(id, username, avatar_url, avatar_color, level)\n      ").or(`challenger_id.eq.${a},challenged_id.eq.${a}`).order("created_at",{ascending:!1});if(r)throw r;return t||[]}};export{r as c,a as f,t as n};
