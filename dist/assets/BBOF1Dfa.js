function t(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]])}return r}function e(t,e,r,i){return new(r||(r=Promise))(function(s,n){function o(t){try{h(i.next(t))}catch(e){n(e)}}function a(t){try{h(i.throw(t))}catch(e){n(e)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(o,a)}h((i=i.apply(t,e||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;class r extends Error{constructor(t,e="FunctionsError",r){super(t),this.name=e,this.context=r}}class i extends r{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class s extends r{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class n extends r{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var o,a;(a=o||(o={})).Any="any",a.ApNortheast1="ap-northeast-1",a.ApNortheast2="ap-northeast-2",a.ApSouth1="ap-south-1",a.ApSoutheast1="ap-southeast-1",a.ApSoutheast2="ap-southeast-2",a.CaCentral1="ca-central-1",a.EuCentral1="eu-central-1",a.EuWest1="eu-west-1",a.EuWest2="eu-west-2",a.EuWest3="eu-west-3",a.SaEast1="sa-east-1",a.UsEast1="us-east-1",a.UsWest1="us-west-1",a.UsWest2="us-west-2";class h{constructor(t,{headers:e={},customFetch:r,region:i=o.Any}={}){this.url=t,this.headers=e,this.region=i,this.fetch=(t=>t?(...e)=>t(...e):(...t)=>fetch(...t))(r)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return e(this,arguments,void 0,function*(t,e={}){var r;let o,a;try{const{headers:h,method:l,body:c,signal:u,timeout:d}=e;let f={},{region:w}=e;w||(w=this.region);const v=new URL(`${this.url}/${t}`);let y;w&&"any"!==w&&(f["x-region"]=w,v.searchParams.set("forceFunctionRegion",w)),c&&(h&&!Object.prototype.hasOwnProperty.call(h,"Content-Type")||!h)?"undefined"!=typeof Blob&&c instanceof Blob||c instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",y=c):"string"==typeof c?(f["Content-Type"]="text/plain",y=c):"undefined"!=typeof FormData&&c instanceof FormData?y=c:(f["Content-Type"]="application/json",y=JSON.stringify(c)):y=!c||"string"==typeof c||"undefined"!=typeof Blob&&c instanceof Blob||c instanceof ArrayBuffer||"undefined"!=typeof FormData&&c instanceof FormData?c:JSON.stringify(c);let p=u;d&&(a=new AbortController,o=setTimeout(()=>a.abort(),d),u?(p=a.signal,u.addEventListener("abort",()=>a.abort())):p=a.signal);const b=yield this.fetch(v.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),h),body:y,signal:p}).catch(t=>{throw new i(t)}),m=b.headers.get("x-relay-error");if(m&&"true"===m)throw new s(b);if(!b.ok)throw new n(b);let g,_=(null!==(r=b.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return g="application/json"===_?yield b.json():"application/octet-stream"===_||"application/pdf"===_?yield b.blob():"text/event-stream"===_?b:"multipart/form-data"===_?yield b.formData():yield b.text(),{data:g,error:null,response:b}}catch(h){return{data:null,error:h,response:h instanceof n||h instanceof s?h.context:void 0}}finally{o&&clearTimeout(o)}})}}var l=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},c=class{constructor(t){var e,r,i;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=null!==(e=t.shouldThrowOnError)&&void 0!==e&&e,this.signal=t.signal,this.isMaybeSingle=null!==(r=t.isMaybeSingle)&&void 0!==r&&r,this.urlLengthLimit=null!==(i=t.urlLengthLimit)&&void 0!==i?i:8e3,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var r=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let i=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async t=>{let e=null,i=null,s=null,n=t.status,o=t.statusText;if(t.ok){var a,h;if("HEAD"!==r.method){var c;const e=await t.text();""===e||(i="text/csv"===r.headers.get("Accept")||r.headers.get("Accept")&&(null===(c=r.headers.get("Accept"))||void 0===c?void 0:c.includes("application/vnd.pgrst.plan+text"))?e:JSON.parse(e))}const l=null===(a=r.headers.get("Prefer"))||void 0===a?void 0:a.match(/count=(exact|planned|estimated)/),u=null===(h=t.headers.get("content-range"))||void 0===h?void 0:h.split("/");l&&u&&u.length>1&&(s=parseInt(u[1])),r.isMaybeSingle&&"GET"===r.method&&Array.isArray(i)&&(i.length>1?(e={code:"PGRST116",details:`Results contain ${i.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},i=null,s=null,n=406,o="Not Acceptable"):i=1===i.length?i[0]:null)}else{var u;const s=await t.text();try{e=JSON.parse(s),Array.isArray(e)&&404===t.status&&(i=[],e=null,n=200,o="OK")}catch(d){404===t.status&&""===s?(n=204,o="No Content"):e={message:s}}if(e&&r.isMaybeSingle&&(null==e||null===(u=e.details)||void 0===u?void 0:u.includes("0 rows"))&&(e=null,n=200,o="OK"),e&&r.shouldThrowOnError)throw new l(e)}return{error:e,data:i,count:s,status:n,statusText:o}});return this.shouldThrowOnError||(i=i.catch(t=>{var e;let r="",i="",s="";const n=null==t?void 0:t.cause;if(n){var o,a,h,l;const e=null!==(o=null==n?void 0:n.message)&&void 0!==o?o:"",i=null!==(a=null==n?void 0:n.code)&&void 0!==a?a:"";r=`${null!==(h=null==t?void 0:t.name)&&void 0!==h?h:"FetchError"}: ${null==t?void 0:t.message}`,r+=`\n\nCaused by: ${null!==(l=null==n?void 0:n.name)&&void 0!==l?l:"Error"}: ${e}`,i&&(r+=` (${i})`),(null==n?void 0:n.stack)&&(r+=`\n${n.stack}`)}else{var c;r=null!==(c=null==t?void 0:t.stack)&&void 0!==c?c:""}const u=this.url.toString().length;return"AbortError"===(null==t?void 0:t.name)||"ABORT_ERR"===(null==t?void 0:t.code)?(s="",i="Request was aborted (timeout or manual cancellation)",u>this.urlLengthLimit&&(i+=`. Note: Your request URL is ${u} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):"HeadersOverflowError"!==(null==n?void 0:n.name)&&"UND_ERR_HEADERS_OVERFLOW"!==(null==n?void 0:n.code)||(s="",i="HTTP headers exceeded server limits (typically 16KB)",u>this.urlLengthLimit&&(i+=`. Your request URL is ${u} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${null!==(e=null==t?void 0:t.name)&&void 0!==e?e:"FetchError"}: ${null==t?void 0:t.message}`,details:r,hint:i,code:s},data:null,count:null,status:0,statusText:""}})),i.then(t,e)}returns(){return this}overrideTypes(){return this}},u=class extends c{select(t){let e=!1;const r=(null!=t?t:"*").split("").map(t=>/\s/.test(t)&&!e?"":('"'===t&&(e=!e),t)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:r,foreignTable:i,referencedTable:s=i}={}){const n=s?`${s}.order`:"order",o=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:r=e}={}){const i=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${t}`),this}range(t,e,{foreignTable:r,referencedTable:i=r}={}){const s=void 0===i?"offset":`${i}.offset`,n=void 0===i?"limit":`${i}.limit`;return this.url.searchParams.set(s,`${t}`),this.url.searchParams.set(n,""+(e-t+1)),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:r=!1,buffers:i=!1,wal:s=!1,format:n="text"}={}){var o;const a=[t?"analyze":null,e?"verbose":null,r?"settings":null,i?"buffers":null,s?"wal":null].filter(Boolean).join("|"),h=null!==(o=this.headers.get("Accept"))&&void 0!==o?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${n}; for="${h}"; options=${a};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const d=new RegExp("[,()]");var f=class extends u{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const r=Array.from(new Set(e)).map(t=>"string"==typeof t&&d.test(t)?`"${t}"`:`${t}`).join(",");return this.url.searchParams.append(t,`in.(${r})`),this}notIn(t,e){const r=Array.from(new Set(e)).map(t=>"string"==typeof t&&d.test(t)?`"${t}"`:`${t}`).join(",");return this.url.searchParams.append(t,`not.in.(${r})`),this}contains(t,e){return"string"==typeof e?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return"string"==typeof e?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return"string"==typeof e?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:r,type:i}={}){let s="";"plain"===i?s="pl":"phrase"===i?s="ph":"websearch"===i&&(s="w");const n=void 0===r?"":`(${r})`;return this.url.searchParams.append(t,`${s}fts${n}.${e}`),this}match(t){return Object.entries(t).forEach(([t,e])=>{this.url.searchParams.append(t,`eq.${e}`)}),this}not(t,e,r){return this.url.searchParams.append(t,`not.${e}.${r}`),this}or(t,{foreignTable:e,referencedTable:r=e}={}){const i=r?`${r}.or`:"or";return this.url.searchParams.append(i,`(${t})`),this}filter(t,e,r){return this.url.searchParams.append(t,`${e}.${r}`),this}},w=class{constructor(t,{headers:e={},schema:r,fetch:i,urlLengthLimit:s=8e3}){this.url=t,this.headers=new Headers(e),this.schema=r,this.fetch=i,this.urlLengthLimit=s}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(t,e){const{head:r=!1,count:i}=null!=e?e:{},s=r?"HEAD":"GET";let n=!1;const o=(null!=t?t:"*").split("").map(t=>/\s/.test(t)&&!n?"":('"'===t&&(n=!n),t)).join(""),{url:a,headers:h}=this.cloneRequestState();return a.searchParams.set("select",o),i&&h.append("Prefer",`count=${i}`),new f({method:s,url:a,headers:h,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(t,{count:e,defaultToNull:r=!0}={}){var i;const{url:s,headers:n}=this.cloneRequestState();if(e&&n.append("Prefer",`count=${e}`),r||n.append("Prefer","missing=default"),Array.isArray(t)){const e=t.reduce((t,e)=>t.concat(Object.keys(e)),[]);if(e.length>0){const t=[...new Set(e)].map(t=>`"${t}"`);s.searchParams.set("columns",t.join(","))}}return new f({method:"POST",url:s,headers:n,schema:this.schema,body:t,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(t,{onConflict:e,ignoreDuplicates:r=!1,count:i,defaultToNull:s=!0}={}){var n;const{url:o,headers:a}=this.cloneRequestState();if(a.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),void 0!==e&&o.searchParams.set("on_conflict",e),i&&a.append("Prefer",`count=${i}`),s||a.append("Prefer","missing=default"),Array.isArray(t)){const e=t.reduce((t,e)=>t.concat(Object.keys(e)),[]);if(e.length>0){const t=[...new Set(e)].map(t=>`"${t}"`);o.searchParams.set("columns",t.join(","))}}return new f({method:"POST",url:o,headers:a,schema:this.schema,body:t,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch,urlLengthLimit:this.urlLengthLimit})}update(t,{count:e}={}){var r;const{url:i,headers:s}=this.cloneRequestState();return e&&s.append("Prefer",`count=${e}`),new f({method:"PATCH",url:i,headers:s,schema:this.schema,body:t,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:t}={}){var e;const{url:r,headers:i}=this.cloneRequestState();return t&&i.append("Prefer",`count=${t}`),new f({method:"DELETE",url:r,headers:i,schema:this.schema,fetch:null!==(e=this.fetch)&&void 0!==e?e:fetch,urlLengthLimit:this.urlLengthLimit})}};function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function y(t){var e=function(t,e){if("object"!=v(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e);if("object"!=v(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==v(e)?e:e+""}function p(t,e,r){return(e=y(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function b(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,i)}return r}function m(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?b(Object(r),!0).forEach(function(e){p(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var g=class t{constructor(t,{headers:e={},schema:r,fetch:i,timeout:s,urlLengthLimit:n=8e3}={}){this.url=t,this.headers=new Headers(e),this.schemaName=r,this.urlLengthLimit=n;const o=null!=i?i:globalThis.fetch;this.fetch=void 0!==s&&s>0?(t,e)=>{const r=new AbortController,i=setTimeout(()=>r.abort(),s),n=null==e?void 0:e.signal;if(n){if(n.aborted)return clearTimeout(i),o(t,e);const s=()=>{clearTimeout(i),r.abort()};return n.addEventListener("abort",s,{once:!0}),o(t,m(m({},e),{},{signal:r.signal})).finally(()=>{clearTimeout(i),n.removeEventListener("abort",s)})}return o(t,m(m({},e),{},{signal:r.signal})).finally(()=>clearTimeout(i))}:o}from(t){if(!t||"string"!=typeof t||""===t.trim())throw new Error("Invalid relation name: relation must be a non-empty string.");return new w(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(e){return new t(this.url,{headers:this.headers,schema:e,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(t,e={},{head:r=!1,get:i=!1,count:s}={}){var n;let o;const a=new URL(`${this.url}/rpc/${t}`);let h;const l=t=>null!==t&&"object"==typeof t&&(!Array.isArray(t)||t.some(l)),c=r&&Object.values(e).some(l);c?(o="POST",h=e):r||i?(o=r?"HEAD":"GET",Object.entries(e).filter(([t,e])=>void 0!==e).map(([t,e])=>[t,Array.isArray(e)?`{${e.join(",")}}`:`${e}`]).forEach(([t,e])=>{a.searchParams.append(t,e)})):(o="POST",h=e);const u=new Headers(this.headers);return c?u.set("Prefer",s?`count=${s},return=minimal`:"return=minimal"):s&&u.set("Prefer",`count=${s}`),new f({method:o,url:a,headers:u,schema:this.schemaName,body:h,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch,urlLengthLimit:this.urlLengthLimit})}};class _{constructor(){}static detectEnvironment(){var t;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof global&&void 0!==global.WebSocket)return{type:"native",constructor:global.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(t=navigator.userAgent)||void 0===t?void 0:t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const e=globalThis.process;if(e){const t=e.versions;if(t&&t.node){const e=t.node,r=parseInt(e.replace(/^v/,"").split(".")[0]);return r>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let e=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(e+=`\n\nSuggested solution: ${t.workaround}`),new Error(e)}static createWebSocket(t,e){return new(this.getWebSocketConstructor())(t,e)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return"native"===t.type||"ws"===t.type}catch(t){return!1}}}const $="2.0.0",E=$,S=1e4;var O,k,T,j,A,I,R,P,x,N,U;(k=O||(O={}))[k.connecting=0]="connecting",k[k.open=1]="open",k[k.closing=2]="closing",k[k.closed=3]="closed",(j=T||(T={})).closed="closed",j.errored="errored",j.joined="joined",j.joining="joining",j.leaving="leaving",(I=A||(A={})).close="phx_close",I.error="phx_error",I.join="phx_join",I.reply="phx_reply",I.leave="phx_leave",I.access_token="access_token",(R||(R={})).websocket="websocket",(x=P||(P={})).Connecting="connecting",x.Open="open",x.Closing="closing",x.Closed="closed";class C{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=null!=t?t:[]}encode(t,e){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&"string"==typeof t.payload.event)return e(this.t(t));let r=[t.join_ref,t.ref,t.topic,t.event,t.payload];return e(JSON.stringify(r))}t(t){var e;return this.i(null===(e=t.payload)||void 0===e?void 0:e.payload)?this.o(t):this.h(t)}o(t){var e,r;const i=null!==(r=null===(e=t.payload)||void 0===e?void 0:e.payload)&&void 0!==r?r:new ArrayBuffer(0);return this.l(t,this.BINARY_ENCODING,i)}h(t){var e,r;const i=null!==(r=null===(e=t.payload)||void 0===e?void 0:e.payload)&&void 0!==r?r:{},s=(new TextEncoder).encode(JSON.stringify(i)).buffer;return this.l(t,this.JSON_ENCODING,s)}l(t,e,r){var i,s;const n=t.topic,o=null!==(i=t.ref)&&void 0!==i?i:"",a=null!==(s=t.join_ref)&&void 0!==s?s:"",h=t.payload.event,l=this.allowedMetadataKeys?this.u(t.payload,this.allowedMetadataKeys):{},c=0===Object.keys(l).length?"":JSON.stringify(l);if(a.length>255)throw new Error(`joinRef length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`ref length ${o.length} exceeds maximum of 255`);if(n.length>255)throw new Error(`topic length ${n.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`userEvent length ${h.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`metadata length ${c.length} exceeds maximum of 255`);const u=this.USER_BROADCAST_PUSH_META_LENGTH+a.length+o.length+n.length+h.length+c.length,d=new ArrayBuffer(this.HEADER_LENGTH+u);let f=new DataView(d),w=0;f.setUint8(w++,this.KINDS.userBroadcastPush),f.setUint8(w++,a.length),f.setUint8(w++,o.length),f.setUint8(w++,n.length),f.setUint8(w++,h.length),f.setUint8(w++,c.length),f.setUint8(w++,e),Array.from(a,t=>f.setUint8(w++,t.charCodeAt(0))),Array.from(o,t=>f.setUint8(w++,t.charCodeAt(0))),Array.from(n,t=>f.setUint8(w++,t.charCodeAt(0))),Array.from(h,t=>f.setUint8(w++,t.charCodeAt(0))),Array.from(c,t=>f.setUint8(w++,t.charCodeAt(0)));var v=new Uint8Array(d.byteLength+r.byteLength);return v.set(new Uint8Array(d),0),v.set(new Uint8Array(r),d.byteLength),v.buffer}decode(t,e){if(this.i(t)){return e(this.v(t))}if("string"==typeof t){const r=JSON.parse(t),[i,s,n,o,a]=r;return e({join_ref:i,ref:s,topic:n,event:o,payload:a})}return e({})}v(t){const e=new DataView(t),r=e.getUint8(0),i=new TextDecoder;if(r===this.KINDS.userBroadcast)return this.p(t,e,i)}p(t,e,r){const i=e.getUint8(1),s=e.getUint8(2),n=e.getUint8(3),o=e.getUint8(4);let a=this.HEADER_LENGTH+4;const h=r.decode(t.slice(a,a+i));a+=i;const l=r.decode(t.slice(a,a+s));a+=s;const c=r.decode(t.slice(a,a+n));a+=n;const u=t.slice(a,t.byteLength),d=o===this.JSON_ENCODING?JSON.parse(r.decode(u)):u,f={type:this.BROADCAST_EVENT,event:l,payload:d};return n>0&&(f.meta=JSON.parse(c)),{join_ref:null,ref:null,topic:h,event:this.BROADCAST_EVENT,payload:f}}i(t){var e;return t instanceof ArrayBuffer||"ArrayBuffer"===(null===(e=null==t?void 0:t.constructor)||void 0===e?void 0:e.name)}u(t,e){return t&&"object"==typeof t?Object.fromEntries(Object.entries(t).filter(([t])=>e.includes(t))):{}}}class D{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(U=N||(N={})).abstime="abstime",U.bool="bool",U.date="date",U.daterange="daterange",U.float4="float4",U.float8="float8",U.int2="int2",U.int4="int4",U.int4range="int4range",U.int8="int8",U.int8range="int8range",U.json="json",U.jsonb="jsonb",U.money="money",U.numeric="numeric",U.oid="oid",U.reltime="reltime",U.text="text",U.time="time",U.timestamp="timestamp",U.timestamptz="timestamptz",U.timetz="timetz",U.tsrange="tsrange",U.tstzrange="tstzrange";const L=(t,e,r={})=>{var i;const s=null!==(i=r.skipTypes)&&void 0!==i?i:[];return e?Object.keys(e).reduce((r,i)=>(r[i]=B(i,t,e,s),r),{}):{}},B=(t,e,r,i)=>{const s=e.find(e=>e.name===t),n=null==s?void 0:s.type,o=r[t];return n&&!i.includes(n)?q(n,o):W(o)},q=(t,e)=>{if("_"===t.charAt(0)){const r=t.slice(1,t.length);return H(e,r)}switch(t){case N.bool:return G(e);case N.float4:case N.float8:case N.int2:case N.int4:case N.int8:case N.numeric:case N.oid:return J(e);case N.json:case N.jsonb:return F(e);case N.timestamp:return V(e);case N.abstime:case N.date:case N.daterange:case N.int4range:case N.int8range:case N.money:case N.reltime:case N.text:case N.time:case N.timestamptz:case N.timetz:case N.tsrange:case N.tstzrange:default:return W(e)}},W=t=>t,G=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},J=t=>{if("string"==typeof t){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},F=t=>{if("string"==typeof t)try{return JSON.parse(t)}catch(e){return t}return t},H=(t,e)=>{if("string"!=typeof t)return t;const r=t.length-1,i=t[r];if("{"===t[0]&&"}"===i){let i;const n=t.slice(1,r);try{i=JSON.parse("["+n+"]")}catch(s){i=n?n.split(","):[]}return i.map(t=>q(e,t))}return t},V=t=>"string"==typeof t?t.replace(" ","T"):t,M=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===e.pathname||"/"===e.pathname?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class K{constructor(t,e,r={},i=1e4){this.channel=t,this.event=e,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this.m(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel.$()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var r;return this._(t)&&e(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket.S(),this.refEvent=this.channel.O(this.ref);this.channel.k(this.refEvent,{},t=>{this.m(),this.T(),this.receivedResp=t,this.j(t)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,e){this.refEvent&&this.channel.A(this.refEvent,{status:t,response:e})}destroy(){this.m(),this.T()}m(){this.refEvent&&this.channel.I(this.refEvent,{})}T(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}j({status:t,response:e}){this.recHooks.filter(e=>e.status===t).forEach(t=>t.callback(e))}_(t){return this.receivedResp&&this.receivedResp.status===t}}var z,Y,X,Q,Z,tt,et,rt;(Y=z||(z={})).SYNC="sync",Y.JOIN="join",Y.LEAVE="leave";class it{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==e?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel.k(r.state,{},t=>{const{onJoin:e,onLeave:r,onSync:i}=this.caller;this.joinRef=this.channel.$(),this.state=it.syncState(this.state,t,e,r),this.pendingDiffs.forEach(t=>{this.state=it.syncDiff(this.state,t,e,r)}),this.pendingDiffs=[],i()}),this.channel.k(r.diff,{},t=>{const{onJoin:e,onLeave:r,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(t):(this.state=it.syncDiff(this.state,t,e,r),i())}),this.onJoin((t,e,r)=>{this.channel.A("presence",{event:"join",key:t,currentPresences:e,newPresences:r})}),this.onLeave((t,e,r)=>{this.channel.A("presence",{event:"leave",key:t,currentPresences:e,leftPresences:r})}),this.onSync(()=>{this.channel.A("presence",{event:"sync"})})}static syncState(t,e,r,i){const s=this.cloneDeep(t),n=this.transformState(e),o={},a={};return this.map(s,(t,e)=>{n[t]||(a[t]=e)}),this.map(n,(t,e)=>{const r=s[t];if(r){const i=e.map(t=>t.presence_ref),s=r.map(t=>t.presence_ref),n=e.filter(t=>s.indexOf(t.presence_ref)<0),h=r.filter(t=>i.indexOf(t.presence_ref)<0);n.length>0&&(o[t]=n),h.length>0&&(a[t]=h)}else o[t]=e}),this.syncDiff(s,{joins:o,leaves:a},r,i)}static syncDiff(t,e,r,i){const{joins:s,leaves:n}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return r||(r=()=>{}),i||(i=()=>{}),this.map(s,(e,i)=>{var s;const n=null!==(s=t[e])&&void 0!==s?s:[];if(t[e]=this.cloneDeep(i),n.length>0){const r=t[e].map(t=>t.presence_ref),i=n.filter(t=>r.indexOf(t.presence_ref)<0);t[e].unshift(...i)}r(e,n,i)}),this.map(n,(e,r)=>{let s=t[e];if(!s)return;const n=r.map(t=>t.presence_ref);s=s.filter(t=>n.indexOf(t.presence_ref)<0),t[e]=s,i(e,s,r),0===s.length&&delete t[e]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(r=>e(r,t[r]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,r)=>{const i=t[r];return e[r]="metas"in i?i.metas.map(t=>(t.presence_ref=t.phx_ref,delete t.phx_ref,delete t.phx_ref_prev,t)):i,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel.$()}}(Q=X||(X={})).ALL="*",Q.INSERT="INSERT",Q.UPDATE="UPDATE",Q.DELETE="DELETE",(tt=Z||(Z={})).BROADCAST="broadcast",tt.PRESENCE="presence",tt.POSTGRES_CHANGES="postgres_changes",tt.SYSTEM="system",(rt=et||(et={})).SUBSCRIBED="SUBSCRIBED",rt.TIMED_OUT="TIMED_OUT",rt.CLOSED="CLOSED",rt.CHANNEL_ERROR="CHANNEL_ERROR";class st{constructor(t,e={config:{}},r){var i,s;if(this.topic=t,this.params=e,this.socket=r,this.bindings={},this.state=T.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new K(this,A.join,this.params,this.timeout),this.rejoinTimer=new D(()=>this.R(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=T.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(t=>t.send()),this.pushBuffer=[]}),this.P(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this.$()}`),this.state=T.closed,this.socket.N(this)}),this.U(t=>{this.C()||this.D()||(this.socket.log("channel",`error ${this.topic}`,t),this.state=T.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this.L()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=T.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",t=>{this.C()||this.D()||(this.socket.log("channel",`error ${this.topic}`,t),this.state=T.errored,this.rejoinTimer.scheduleTimeout())}),this.k(A.reply,{},(t,e)=>{this.A(this.O(e),t)}),this.presence=new it(this),this.broadcastEndpointURL=M(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(s=null===(i=this.params.config)||void 0===i?void 0:i.broadcast)||void 0===s?void 0:s.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,e=this.timeout){var r,i,s;if(this.socket.isConnected()||this.socket.connect(),this.state==T.closed){const{config:{broadcast:n,presence:o,private:a}}=this.params,h=null!==(i=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(t=>t.filter))&&void 0!==i?i:[],l=!!this.bindings[Z.PRESENCE]&&this.bindings[Z.PRESENCE].length>0||!0===(null===(s=this.params.config.presence)||void 0===s?void 0:s.enabled),c={},u={broadcast:n,presence:Object.assign(Object.assign({},o),{enabled:l}),postgres_changes:h,private:a};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.U(e=>null==t?void 0:t(et.CHANNEL_ERROR,e)),this.P(()=>null==t?void 0:t(et.CLOSED)),this.updateJoinPayload(Object.assign({config:u},c)),this.joinedOnce=!0,this.B(e),this.joinPush.receive("ok",async({postgres_changes:e})=>{var r;if(this.socket.q()||this.socket.setAuth(),void 0!==e){const i=this.bindings.postgres_changes,s=null!==(r=null==i?void 0:i.length)&&void 0!==r?r:0,n=[];for(let r=0;r<s;r++){const s=i[r],{filter:{event:o,schema:a,table:h,filter:l}}=s,c=e&&e[r];if(!(c&&c.event===o&&st.isFilterValueEqual(c.schema,a)&&st.isFilterValueEqual(c.table,h)&&st.isFilterValueEqual(c.filter,l)))return this.unsubscribe(),this.state=T.errored,void(null==t||t(et.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));n.push(Object.assign(Object.assign({},s),{id:c.id}))}return this.bindings.postgres_changes=n,void(t&&t(et.SUBSCRIBED))}null==t||t(et.SUBSCRIBED)}).receive("error",e=>{this.state=T.errored,null==t||t(et.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(e).join(", ")||"error")))}).receive("timeout",()=>{null==t||t(et.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,e={}){return await this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,e,r){return this.state===T.joined&&t===Z.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this.k(t,e,r)}async httpSend(t,e,r={}){var i;if(null==e)return Promise.reject("Payload is required for httpSend()");const s={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(s.Authorization=`Bearer ${this.socket.accessTokenValue}`);const n={method:"POST",headers:s,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:e,private:this.private}]})},o=await this.W(this.broadcastEndpointURL,n,null!==(i=r.timeout)&&void 0!==i?i:this.timeout);if(202===o.status)return{success:!0};let a=o.statusText;try{const t=await o.json();a=t.error||t.message||a}catch(h){}return Promise.reject(new Error(a))}async send(t,e={}){var r,i;if(this.G()||"broadcast"!==t.type)return new Promise(r=>{var i,s,n;const o=this.J(t.type,t,e.timeout||this.timeout);"broadcast"!==t.type||(null===(n=null===(s=null===(i=this.params)||void 0===i?void 0:i.config)||void 0===s?void 0:s.broadcast)||void 0===n?void 0:n.ack)||r("ok"),o.receive("ok",()=>r("ok")),o.receive("error",()=>r("error")),o.receive("timeout",()=>r("timed out"))});{const{event:n,payload:o}=t,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const h={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:o,private:this.private}]})};try{const t=await this.W(this.broadcastEndpointURL,h,null!==(r=e.timeout)&&void 0!==r?r:this.timeout);return await(null===(i=t.body)||void 0===i?void 0:i.cancel()),t.ok?"ok":"error"}catch(s){return"AbortError"===s.name?"timed out":"error"}}}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=T.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this.A(A.close,"leave",this.$())};this.joinPush.destroy();let r=null;return new Promise(i=>{r=new K(this,A.leave,{},t),r.receive("ok",()=>{e(),i("ok")}).receive("timeout",()=>{e(),i("timed out")}).receive("error",()=>{i("error")}),r.send(),this.G()||r.trigger("ok",{})}).finally(()=>{null==r||r.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=T.closed,this.bindings={}}async W(t,e,r){const i=new AbortController,s=setTimeout(()=>i.abort(),r),n=await this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:i.signal}));return clearTimeout(s),n}J(t,e,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new K(this,t,e,r);return this.G()?i.send():this.F(i),i}F(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>100){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}H(t,e,r){return e}V(t){return this.topic===t}$(){return this.joinPush.ref}A(t,e,r){var i,s;const n=t.toLocaleLowerCase(),{close:o,error:a,leave:h,join:l}=A;if(r&&[o,a,h,l].indexOf(n)>=0&&r!==this.$())return;let c=this.H(n,e,r);if(e&&!c)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(n)?null===(i=this.bindings.postgres_changes)||void 0===i||i.filter(t=>{var e,r,i;return"*"===(null===(e=t.filter)||void 0===e?void 0:e.event)||(null===(i=null===(r=t.filter)||void 0===r?void 0:r.event)||void 0===i?void 0:i.toLocaleLowerCase())===n}).map(t=>t.callback(c,r)):null===(s=this.bindings[n])||void 0===s||s.filter(t=>{var r,i,s,o,a,h;if(["broadcast","presence","postgres_changes"].includes(n)){if("id"in t){const n=t.id,o=null===(r=t.filter)||void 0===r?void 0:r.event;return n&&(null===(i=e.ids)||void 0===i?void 0:i.includes(n))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(s=e.data)||void 0===s?void 0:s.type.toLocaleLowerCase()))}{const r=null===(a=null===(o=null==t?void 0:t.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===r||r===(null===(h=null==e?void 0:e.event)||void 0===h?void 0:h.toLocaleLowerCase())}}return t.type.toLocaleLowerCase()===n}).map(t=>{if("object"==typeof c&&"ids"in c){const t=c.data,{schema:e,table:r,commit_timestamp:i,type:s,errors:n}=t,o={schema:e,table:r,commit_timestamp:i,eventType:s,new:{},old:{},errors:n};c=Object.assign(Object.assign({},o),this.M(t))}t.callback(c,r)})}D(){return this.state===T.closed}K(){return this.state===T.joined}L(){return this.state===T.joining}C(){return this.state===T.leaving}O(t){return`chan_reply_${t}`}k(t,e,r){const i=t.toLocaleLowerCase(),s={type:i,filter:e,callback:r};return this.bindings[i]?this.bindings[i].push(s):this.bindings[i]=[s],this}I(t,e){const r=t.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(t=>{var i;return!((null===(i=t.type)||void 0===i?void 0:i.toLocaleLowerCase())===r&&st.isEqual(t.filter,e))})),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const r in t)if(t[r]!==e[r])return!1;return!0}static isFilterValueEqual(t,e){return(null!=t?t:void 0)===(null!=e?e:void 0)}R(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.B()}P(t){this.k(A.close,{},t)}U(t){this.k(A.error,{},e=>t(e))}G(){return this.socket.isConnected()&&this.K()}B(t=this.timeout){this.C()||(this.socket.Y(this.topic),this.state=T.joining,this.joinPush.resend(t))}M(t){const e={new:{},old:{}};return"INSERT"!==t.type&&"UPDATE"!==t.type||(e.new=L(t.columns,t.record)),"UPDATE"!==t.type&&"DELETE"!==t.type||(e.old=L(t.columns,t.old_record)),e}}const nt=()=>{},ot=25e3,at=10,ht=100,lt=[1e3,2e3,5e3,1e4];class ct{constructor(t,e){var r;if(this.accessTokenValue=null,this.apiKey=null,this.X=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=S,this.transport=null,this.heartbeatIntervalMs=ot,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=nt,this.ref=0,this.reconnectTimer=null,this.vsn=E,this.logger=nt,this.conn=null,this.sendBuffer=[],this.serializer=new C,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this.Z="disconnected",this.tt=!1,this.et=null,this.rt=null,this.it=t=>t?(...e)=>t(...e):(...t)=>fetch(...t),!(null===(r=null==e?void 0:e.params)||void 0===r?void 0:r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=e.params.apikey,this.endPoint=`${t}/${R.websocket}`,this.httpEndpoint=M(t),this.st(e),this.nt(),this.fetch=this.it(null==e?void 0:e.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this.ot("connecting"),this.accessToken&&!this.et&&this.ht("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=_.createWebSocket(this.endpointURL())}catch(t){this.ot("disconnected");const e=t.message;if(e.includes("Node.js"))throw new Error(`${e}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${e}`)}this.ct()}}endpointURL(){return this.ut(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,e){if(!this.isDisconnecting())if(this.ot("disconnecting",!0),this.conn){const r=setTimeout(()=>{this.ot("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this.ot("disconnected")},"function"==typeof this.conn.close&&(t?this.conn.close(t,null!=e?e:""):this.conn.close()),this.dt()}else this.ot("disconnected")}getChannels(){return this.channels}async removeChannel(t){const e=await t.unsubscribe();return 0===this.channels.length&&this.disconnect(),e}async removeAllChannels(){const t=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,e,r){this.logger(t,e,r)}connectionState(){switch(this.conn&&this.conn.readyState){case O.connecting:return P.Connecting;case O.open:return P.Open;case O.closing:return P.Closing;default:return P.Closed}}isConnected(){return this.connectionState()===P.Open}isConnecting(){return"connecting"===this.Z}isDisconnecting(){return"disconnecting"===this.Z}channel(t,e={config:{}}){const r=`realtime:${t}`,i=this.getChannels().find(t=>t.topic===r);if(i)return i;{const r=new st(`realtime:${t}`,e,this);return this.channels.push(r),r}}push(t){const{topic:e,event:r,payload:i,ref:s}=t,n=()=>{this.encode(t,t=>{var e;null===(e=this.conn)||void 0===e||e.send(t)})};this.log("push",`${e} ${r} (${s})`,i),this.isConnected()?n():this.sendBuffer.push(n)}async setAuth(t=null){this.et=this.ft(t);try{await this.et}finally{this.et=null}}q(){return this.X}async sendHeartbeat(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.rt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}return this.tt=!1,null===(t=this.conn)||void 0===t||t.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var t;this.isConnected()||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout()},ht)}this.rt=Date.now(),this.pendingHeartbeatRef=this.S(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this.ht("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}S(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}Y(t){let e=this.channels.find(e=>e.topic===t&&(e.K()||e.L()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}N(t){this.channels=this.channels.filter(e=>e.topic!==t.topic)}wt(t){this.decode(t.data,t=>{if("phoenix"===t.topic&&"phx_reply"===t.event&&t.ref&&t.ref===this.pendingHeartbeatRef){const e=this.rt?Date.now()-this.rt:void 0;try{this.heartbeatCallback("ok"===t.payload.status?"ok":"error",e)}catch(a){this.log("error","error in heartbeat callback",a)}this.rt=null,this.pendingHeartbeatRef=null}const{topic:e,event:r,payload:i,ref:s}=t,n=s?`(${s})`:"",o=i.status||"";this.log("receive",`${o} ${e} ${r} ${n}`.trim(),i),this.channels.filter(t=>t.V(e)).forEach(t=>t.A(r,i,s)),this.vt("message",t)})}yt(t){var e;"heartbeat"===t&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===t&&(null===(e=this.reconnectTimer)||void 0===e||e.reset())}bt(){this.yt("heartbeat"),this.yt("reconnect")}ct(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._t(),this.conn.onerror=t=>this.$t(t),this.conn.onmessage=t=>this.wt(t),this.conn.onclose=t=>this.Et(t),this.conn.readyState===O.open&&this._t())}dt(){if(this.conn){if(this.conn.readyState===O.open||this.conn.readyState===O.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this.bt(),this.St(),this.channels.forEach(t=>t.teardown())}_t(){this.ot("connected"),this.log("transport",`connected to ${this.endpointURL()}`);(this.et||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this.yt("reconnect"),this.worker?this.workerRef||this.Ot():this.kt(),this.vt("open")}kt(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}Ot(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this.Tt(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.St()},this.workerRef.onmessage=t=>{"keepAlive"===t.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}St(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}Et(t){var e;this.ot("disconnected"),this.log("transport","close",t),this.jt(),this.yt("heartbeat"),this.tt||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout(),this.vt("close",t)}$t(t){this.ot("disconnected"),this.log("transport",`${t}`),this.jt(),this.vt("error",t);try{this.heartbeatCallback("error")}catch(e){this.log("error","error in heartbeat callback",e)}}jt(){this.channels.forEach(t=>t.A(A.error))}ut(t,e){if(0===Object.keys(e).length)return t;const r=t.match(/\?/)?"&":"?";return`${t}${r}${new URLSearchParams(e)}`}Tt(t){let e;if(t)e=t;else{const t=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});e=URL.createObjectURL(t)}return e}ot(t,e=!1){this.Z=t,"connecting"===t?this.tt=!1:"disconnecting"===t&&(this.tt=e)}async ft(t=null){let e,r=!1;if(t)e=t,r=!0;else if(this.accessToken)try{e=await this.accessToken()}catch(i){this.log("error","Error fetching access token from callback",i),e=this.accessTokenValue}else e=this.accessTokenValue;r?this.X=!0:this.accessToken&&(this.X=!1),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(t=>{const r={access_token:e,version:"realtime-js/2.94.1"};e&&t.updateJoinPayload(r),t.joinedOnce&&t.K()&&t.J(A.access_token,{access_token:e})}))}async At(){this.et&&await this.et}ht(t="general"){this.q()||this.setAuth().catch(e=>{this.log("error",`Error setting auth in ${t}`,e)})}vt(t,e){try{this.stateChangeCallbacks[t].forEach(r=>{try{r(e)}catch(i){this.log("error",`error in ${t} callback`,i)}})}catch(r){this.log("error",`error triggering ${t} callbacks`,r)}}nt(){this.reconnectTimer=new D(async()=>{setTimeout(async()=>{await this.At(),this.isConnected()||this.connect()},at)},this.reconnectAfterMs)}st(t){var e,r,i,s,n,o,a,h,l,c,u,d;switch(this.transport=null!==(e=null==t?void 0:t.transport)&&void 0!==e?e:null,this.timeout=null!==(r=null==t?void 0:t.timeout)&&void 0!==r?r:S,this.heartbeatIntervalMs=null!==(i=null==t?void 0:t.heartbeatIntervalMs)&&void 0!==i?i:ot,this.worker=null!==(s=null==t?void 0:t.worker)&&void 0!==s&&s,this.accessToken=null!==(n=null==t?void 0:t.accessToken)&&void 0!==n?n:null,this.heartbeatCallback=null!==(o=null==t?void 0:t.heartbeatCallback)&&void 0!==o?o:nt,this.vsn=null!==(a=null==t?void 0:t.vsn)&&void 0!==a?a:E,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.logger)&&(this.logger=t.logger),((null==t?void 0:t.logLevel)||(null==t?void 0:t.log_level))&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(h=null==t?void 0:t.reconnectAfterMs)&&void 0!==h?h:t=>lt[t-1]||1e4,this.vsn){case"1.0.0":this.encode=null!==(l=null==t?void 0:t.encode)&&void 0!==l?l:(t,e)=>e(JSON.stringify(t)),this.decode=null!==(c=null==t?void 0:t.decode)&&void 0!==c?c:(t,e)=>e(JSON.parse(t));break;case $:this.encode=null!==(u=null==t?void 0:t.encode)&&void 0!==u?u:this.serializer.encode.bind(this.serializer),this.decode=null!==(d=null==t?void 0:t.decode)&&void 0!==d?d:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==t?void 0:t.workerUrl}}}var ut=class extends Error{constructor(t,e){var r;super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown="CommitStateUnknownException"===e.icebergType||[500,502,504].includes(e.status)&&!0===(null==(r=e.icebergType)?void 0:r.includes("CommitState"))}isNotFound(){return 404===this.status}isConflict(){return 409===this.status}isAuthenticationTimeout(){return 419===this.status}};function dt(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:r,path:i,query:s,body:n,headers:o}){const a=function(t,e,r){const i=new URL(e,t);if(r)for(const[s,n]of Object.entries(r))void 0!==n&&i.searchParams.set(s,n);return i.toString()}(t.baseUrl,i,s),h=await async function(t){return t&&"none"!==t.type?"bearer"===t.type?{Authorization:`Bearer ${t.token}`}:"header"===t.type?{[t.name]:t.value}:"custom"===t.type?await t.getHeaders():{}:{}}(t.auth),l=await e(a,{method:r,headers:{...n?{"Content-Type":"application/json"}:{},...h,...o},body:n?JSON.stringify(n):void 0}),c=await l.text(),u=(l.headers.get("content-type")||"").includes("application/json"),d=u&&c?JSON.parse(c):c;if(!l.ok){const t=u?d:void 0,e=null==t?void 0:t.error;throw new ut((null==e?void 0:e.message)??`Request failed with status ${l.status}`,{status:l.status,icebergType:null==e?void 0:e.type,icebergCode:null==e?void 0:e.code,details:t})}return{status:l.status,headers:l.headers,data:d}}}}function ft(t){return t.join("")}var wt=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:ft(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(t=>({namespace:t}))}async createNamespace(t,e){const r={namespace:t.namespace,properties:null==e?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${ft(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ft(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${ft(t.namespace)}`}),!0}catch(e){if(e instanceof ut&&404===e.status)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(r){if(r instanceof ut&&409===r.status)return;throw r}}};function vt(t){return t.join("")}var yt=class{constructor(t,e="",r){this.client=t,this.prefix=e,this.accessDelegation=r}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${vt(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const r={};this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation);return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${vt(t.namespace)}/tables`,body:e,headers:r})).data.metadata}async updateTable(t,e){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${vt(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${vt(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((null==e?void 0:e.purge)??!1)}})}async loadTable(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${vt(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${vt(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(r){if(r instanceof ut&&404===r.status)return!1;throw r}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(r){if(r instanceof ut&&409===r.status)return await this.loadTable({namespace:t.namespace,name:e.name});throw r}}},pt=class{constructor(t){var e;let r="v1";t.catalogName&&(r+=`/${t.catalogName}`);const i=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=dt({baseUrl:i,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=null==(e=t.accessDelegation)?void 0:e.join(","),this.namespaceOps=new wt(this.client,r),this.tableOps=new yt(this.client,r,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},bt=class extends Error{constructor(t,e="storage",r,i){super(t),this.It=!0,this.namespace=e,this.name="vectors"===e?"StorageVectorsError":"StorageError",this.status=r,this.statusCode=i}};function mt(t){return"object"==typeof t&&null!==t&&"It"in t}var gt=class extends bt{constructor(t,e,r,i="storage"){super(t,i,e,r),this.name="vectors"===i?"StorageVectorsApiError":"StorageApiError",this.status=e,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},_t=class extends bt{constructor(t,e,r="storage"){super(t,r),this.name="vectors"===r?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=e}};const $t=t=>{if(Array.isArray(t))return t.map(t=>$t(t));if("function"==typeof t||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([t,r])=>{const i=t.replace(/([-_][a-z])/gi,t=>t.toUpperCase().replace(/[-_]/g,""));e[i]=$t(r)}),e};function Et(t){return(Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function St(t){var e=function(t,e){if("object"!=Et(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e);if("object"!=Et(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Et(e)?e:e+""}function Ot(t,e,r){return(e=St(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function kt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,i)}return r}function Tt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?kt(Object(r),!0).forEach(function(e){Ot(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):kt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}const jt=t=>{var e;return t.msg||t.message||t.error_description||("string"==typeof t.error?t.error:null===(e=t.error)||void 0===e?void 0:e.message)||JSON.stringify(t)},At=(t,e,r,i)=>{const s={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"!==t&&"HEAD"!==t&&i?((t=>{if("object"!=typeof t||null===t)return!1;const e=Object.getPrototypeOf(t);return!(null!==e&&e!==Object.prototype&&null!==Object.getPrototypeOf(e)||Symbol.toStringTag in t||Symbol.iterator in t)})(i)?(s.headers=Tt({"Content-Type":"application/json"},null==e?void 0:e.headers),s.body=JSON.stringify(i)):s.body=i,(null==e?void 0:e.duplex)&&(s.duplex=e.duplex),Tt(Tt({},s),r)):Tt(Tt({},s),r)};async function It(t,e,r,i,s,n,o){return new Promise((a,h)=>{t(r,At(e,i,s,n)).then(t=>{if(!t.ok)throw t;if(null==i?void 0:i.noResolveJson)return t;if("vectors"===o){const e=t.headers.get("content-type");if("0"===t.headers.get("content-length")||204===t.status)return{};if(!e||!e.includes("application/json"))return{}}return t.json()}).then(t=>a(t)).catch(t=>(async(t,e,r,i)=>{if(t&&"object"==typeof t&&"status"in t&&"ok"in t&&"number"==typeof t.status&&!(null==r?void 0:r.noResolveJson)){const r=t,s=r.status||500;if("function"==typeof r.json)r.json().then(t=>{const r=(null==t?void 0:t.statusCode)||(null==t?void 0:t.code)||s+"";e(new gt(jt(t),s,r,i))}).catch(()=>{if("vectors"===i){const t=s+"";e(new gt(r.statusText||`HTTP ${s} error`,s,t,i))}else{const t=s+"";e(new gt(r.statusText||`HTTP ${s} error`,s,t,i))}});else{const t=s+"";e(new gt(r.statusText||`HTTP ${s} error`,s,t,i))}}else e(new _t(jt(t),t,i))})(t,h,i,o))})}function Rt(t="storage"){return{get:async(e,r,i,s)=>It(e,"GET",r,i,s,void 0,t),post:async(e,r,i,s,n)=>It(e,"POST",r,s,n,i,t),put:async(e,r,i,s,n)=>It(e,"PUT",r,s,n,i,t),head:async(e,r,i,s)=>It(e,"HEAD",r,Tt(Tt({},i),{},{noResolveJson:!0}),s,void 0,t),remove:async(e,r,i,s,n)=>It(e,"DELETE",r,s,n,i,t)}}const Pt=Rt("storage"),{get:xt,post:Nt,put:Ut,head:Ct,remove:Dt}=Pt,Lt=Rt("vectors");var Bt=class{constructor(t,e={},r,i="storage"){var s;this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.fetch=(s=r)?(...t)=>s(...t):(...t)=>fetch(...t),this.namespace=i}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(t){try{return{data:await t(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(mt(e))return{data:null,error:e};throw e}}},qt=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){try{return{data:(await this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(mt(t))return{data:null,error:t};throw t}}};let Wt;Wt=Symbol.toStringTag;var Gt=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[Wt]="BlobDownloadBuilder",this.promise=null}asStream(){return new qt(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){try{return{data:await(await this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(mt(t))return{data:null,error:t};throw t}}};const Jt={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ft={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var Ht=class extends Bt{constructor(t,e={},r,i){super(t,e,i,"storage"),this.bucketId=r}async uploadOrUpdate(t,e,r,i){var s=this;return s.handleOperation(async()=>{let n;const o=Tt(Tt({},Ft),i);let a=Tt(Tt({},s.headers),"POST"===t&&{"x-upsert":String(o.upsert)});const h=o.metadata;"undefined"!=typeof Blob&&r instanceof Blob?(n=new FormData,n.append("cacheControl",o.cacheControl),h&&n.append("metadata",s.encodeMetadata(h)),n.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(n=r,n.has("cacheControl")||n.append("cacheControl",o.cacheControl),h&&!n.has("metadata")&&n.append("metadata",s.encodeMetadata(h))):(n=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,h&&(a["x-metadata"]=s.toBase64(s.encodeMetadata(h))),("undefined"!=typeof ReadableStream&&n instanceof ReadableStream||n&&"object"==typeof n&&"pipe"in n&&"function"==typeof n.pipe)&&!o.duplex&&(o.duplex="half")),(null==i?void 0:i.headers)&&(a=Tt(Tt({},a),i.headers));const l=s.Rt(e),c=s.Pt(l),u=await("PUT"==t?Ut:Nt)(s.fetch,`${s.url}/object/${c}`,n,Tt({headers:a},(null==o?void 0:o.duplex)?{duplex:o.duplex}:{}));return{path:l,id:u.Id,fullPath:u.Key}})}async upload(t,e,r){return this.uploadOrUpdate("POST",t,e,r)}async uploadToSignedUrl(t,e,r,i){var s=this;const n=s.Rt(t),o=s.Pt(n),a=new URL(s.url+`/object/upload/sign/${o}`);return a.searchParams.set("token",e),s.handleOperation(async()=>{let t;const e=Tt({upsert:Ft.upsert},i),o=Tt(Tt({},s.headers),{"x-upsert":String(e.upsert)});return"undefined"!=typeof Blob&&r instanceof Blob?(t=new FormData,t.append("cacheControl",e.cacheControl),t.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(t=r,t.append("cacheControl",e.cacheControl)):(t=r,o["cache-control"]=`max-age=${e.cacheControl}`,o["content-type"]=e.contentType),{path:n,fullPath:(await Ut(s.fetch,a.toString(),t,{headers:o})).Key}})}async createSignedUploadUrl(t,e){var r=this;return r.handleOperation(async()=>{let i=r.Pt(t);const s=Tt({},r.headers);(null==e?void 0:e.upsert)&&(s["x-upsert"]="true");const n=await Nt(r.fetch,`${r.url}/object/upload/sign/${i}`,{},{headers:s}),o=new URL(r.url+n.url),a=o.searchParams.get("token");if(!a)throw new bt("No token returned by API");return{signedUrl:o.toString(),path:t,token:a}})}async update(t,e,r){return this.uploadOrUpdate("PUT",t,e,r)}async move(t,e,r){var i=this;return i.handleOperation(async()=>await Nt(i.fetch,`${i.url}/object/move`,{bucketId:i.bucketId,sourceKey:t,destinationKey:e,destinationBucket:null==r?void 0:r.destinationBucket},{headers:i.headers}))}async copy(t,e,r){var i=this;return i.handleOperation(async()=>({path:(await Nt(i.fetch,`${i.url}/object/copy`,{bucketId:i.bucketId,sourceKey:t,destinationKey:e,destinationBucket:null==r?void 0:r.destinationBucket},{headers:i.headers})).Key}))}async createSignedUrl(t,e,r){var i=this;return i.handleOperation(async()=>{let s=i.Pt(t),n=await Nt(i.fetch,`${i.url}/object/sign/${s}`,Tt({expiresIn:e},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:i.headers});const o=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{signedUrl:encodeURI(`${i.url}${n.signedURL}${o}`)}})}async createSignedUrls(t,e,r){var i=this;return i.handleOperation(async()=>{const s=await Nt(i.fetch,`${i.url}/object/sign/${i.bucketId}`,{expiresIn:e,paths:t},{headers:i.headers}),n=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return s.map(t=>Tt(Tt({},t),{},{signedUrl:t.signedURL?encodeURI(`${i.url}${t.signedURL}${n}`):null}))})}download(t,e){const r=void 0!==(null==e?void 0:e.transform)?"render/image/authenticated":"object",i=this.transformOptsToQueryString((null==e?void 0:e.transform)||{}),s=i?`?${i}`:"",n=this.Pt(t);return new Gt(()=>xt(this.fetch,`${this.url}/${r}/${n}${s}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}async info(t){var e=this;const r=e.Pt(t);return e.handleOperation(async()=>$t(await xt(e.fetch,`${e.url}/object/info/${r}`,{headers:e.headers})))}async exists(t){var e=this;const r=e.Pt(t);try{return await Ct(e.fetch,`${e.url}/object/${r}`,{headers:e.headers}),{data:!0,error:null}}catch(i){if(e.shouldThrowOnError)throw i;if(mt(i)&&i instanceof _t){const t=i.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:i}}throw i}}getPublicUrl(t,e){const r=this.Pt(t),i=[],s=(null==e?void 0:e.download)?`download=${!0===e.download?"":e.download}`:"";""!==s&&i.push(s);const n=void 0!==(null==e?void 0:e.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==e?void 0:e.transform)||{});""!==o&&i.push(o);let a=i.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${r}${a}`)}}}async remove(t){var e=this;return e.handleOperation(async()=>await Dt(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}))}async list(t,e,r){var i=this;return i.handleOperation(async()=>{const s=Tt(Tt(Tt({},Jt),e),{},{prefix:t||""});return await Nt(i.fetch,`${i.url}/object/list/${i.bucketId}`,s,{headers:i.headers},r)})}async listV2(t,e){var r=this;return r.handleOperation(async()=>{const i=Tt({},t);return await Nt(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,i,{headers:r.headers},e)})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return"undefined"!=typeof Buffer?Buffer.from(t).toString("base64"):btoa(t)}Pt(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}Rt(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const Vt={"X-Client-Info":"storage-js/2.94.1"};var Mt=class extends Bt{constructor(t,e={},r,i){const s=new URL(t);(null==i?void 0:i.useNewHostname)&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase."));super(s.href.replace(/\/$/,""),Tt(Tt({},Vt),e),r,"storage")}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const r=e.listBucketOptionsToQueryString(t);return await xt(e.fetch,`${e.url}/bucket${r}`,{headers:e.headers})})}async getBucket(t){var e=this;return e.handleOperation(async()=>await xt(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}))}async createBucket(t,e={public:!1}){var r=this;return r.handleOperation(async()=>await Nt(r.fetch,`${r.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}))}async updateBucket(t,e){var r=this;return r.handleOperation(async()=>await Ut(r.fetch,`${r.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}))}async emptyBucket(t){var e=this;return e.handleOperation(async()=>await Nt(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await Dt(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},Kt=class extends Bt{constructor(t,e={},r){super(t.replace(/\/$/,""),Tt(Tt({},Vt),e),r,"storage")}async createBucket(t){var e=this;return e.handleOperation(async()=>await Nt(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}))}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const r=new URLSearchParams;void 0!==(null==t?void 0:t.limit)&&r.set("limit",t.limit.toString()),void 0!==(null==t?void 0:t.offset)&&r.set("offset",t.offset.toString()),(null==t?void 0:t.sortColumn)&&r.set("sortColumn",t.sortColumn),(null==t?void 0:t.sortOrder)&&r.set("sortOrder",t.sortOrder),(null==t?void 0:t.search)&&r.set("search",t.search);const i=r.toString(),s=i?`${e.url}/bucket?${i}`:`${e.url}/bucket`;return await xt(e.fetch,s,{headers:e.headers})})}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await Dt(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}from(t){var e=this;if(!(t=>!(!t||"string"!=typeof t)&&!(0===t.length||t.length>100)&&t.trim()===t&&!t.includes("/")&&!t.includes("\\")&&/^[\w!.\*'() &$@=;:+,?-]+$/.test(t))(t))throw new bt("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new pt({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),i=this.shouldThrowOnError;return new Proxy(r,{get(t,e){const r=t[e];return"function"!=typeof r?r:async(...e)=>{try{return{data:await r.apply(t,e),error:null}}catch(s){if(i)throw s;return{data:null,error:s}}}}})}},zt=class extends Bt{constructor(t,e={},r){super(t.replace(/\/$/,""),Tt(Tt({},Vt),{},{"Content-Type":"application/json"},e),r,"vectors")}async createIndex(t){var e=this;return e.handleOperation(async()=>await Lt.post(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{})}async getIndex(t,e){var r=this;return r.handleOperation(async()=>await Lt.post(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:r.headers}))}async listIndexes(t){var e=this;return e.handleOperation(async()=>await Lt.post(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}))}async deleteIndex(t,e){var r=this;return r.handleOperation(async()=>await Lt.post(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:r.headers})||{})}},Yt=class extends Bt{constructor(t,e={},r){super(t.replace(/\/$/,""),Tt(Tt({},Vt),{},{"Content-Type":"application/json"},e),r,"vectors")}async putVectors(t){var e=this;if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Lt.post(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{})}async getVectors(t){var e=this;return e.handleOperation(async()=>await Lt.post(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}))}async listVectors(t){var e=this;if(void 0!==t.segmentCount){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(void 0!==t.segmentIndex&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error("segmentIndex must be between 0 and "+(t.segmentCount-1))}return e.handleOperation(async()=>await Lt.post(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}))}async queryVectors(t){var e=this;return e.handleOperation(async()=>await Lt.post(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}))}async deleteVectors(t){var e=this;if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Lt.post(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{})}},Xt=class extends Bt{constructor(t,e={},r){super(t.replace(/\/$/,""),Tt(Tt({},Vt),{},{"Content-Type":"application/json"},e),r,"vectors")}async createBucket(t){var e=this;return e.handleOperation(async()=>await Lt.post(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}async getBucket(t){var e=this;return e.handleOperation(async()=>await Lt.post(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}))}async listBuckets(t={}){var e=this;return e.handleOperation(async()=>await Lt.post(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await Lt.post(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}},Qt=class extends Xt{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new Zt(this.url,this.headers,t,this.fetch)}async createBucket(t){return(()=>super.createBucket)().call(this,t)}async getBucket(t){return(()=>super.getBucket)().call(this,t)}async listBuckets(t={}){return(()=>super.listBuckets)().call(this,t)}async deleteBucket(t){return(()=>super.deleteBucket)().call(this,t)}},Zt=class extends zt{constructor(t,e,r,i){super(t,e,i),this.vectorBucketName=r}async createIndex(t){return(()=>super.createIndex)().call(this,Tt(Tt({},t),{},{vectorBucketName:this.vectorBucketName}))}async listIndexes(t={}){return(()=>super.listIndexes)().call(this,Tt(Tt({},t),{},{vectorBucketName:this.vectorBucketName}))}async getIndex(t){return(()=>super.getIndex)().call(this,this.vectorBucketName,t)}async deleteIndex(t){return(()=>super.deleteIndex)().call(this,this.vectorBucketName,t)}index(t){return new te(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},te=class extends Yt{constructor(t,e,r,i,s){super(t,e,s),this.vectorBucketName=r,this.indexName=i}async putVectors(t){var e=this;return(()=>super.putVectors)().call(e,Tt(Tt({},t),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async getVectors(t){var e=this;return(()=>super.getVectors)().call(e,Tt(Tt({},t),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async listVectors(t={}){var e=this;return(()=>super.listVectors)().call(e,Tt(Tt({},t),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async queryVectors(t){var e=this;return(()=>super.queryVectors)().call(e,Tt(Tt({},t),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async deleteVectors(t){var e=this;return(()=>super.deleteVectors)().call(e,Tt(Tt({},t),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}},ee=class extends Mt{constructor(t,e={},r,i){super(t,e,r,i)}from(t){return new Ht(this.url,this.headers,t,this.fetch)}get vectors(){return new Qt(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Kt(this.url+"/iceberg",this.headers,this.fetch)}};const re="2.94.1",ie=3e4,se=9e4,ne={"X-Client-Info":`gotrue-js/${re}`},oe="X-Supabase-Api-Version",ae={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},he=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class le extends Error{constructor(t,e,r){super(t),this.xt=!0,this.name="AuthError",this.status=e,this.code=r}}function ce(t){return"object"==typeof t&&null!==t&&"xt"in t}class ue extends le{constructor(t,e,r){super(t,e,r),this.name="AuthApiError",this.status=e,this.code=r}}class de extends le{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}}class fe extends le{constructor(t,e,r,i){super(t,r,i),this.name=e,this.status=r}}class we extends fe{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function ve(t){return ce(t)&&"AuthSessionMissingError"===t.name}class ye extends fe{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class pe extends fe{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class be extends fe{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class me extends fe{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ge extends fe{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class _e extends fe{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}}function $e(t){return ce(t)&&"AuthRetryableFetchError"===t.name}class Ee extends fe{constructor(t,e,r){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=r}}class Se extends fe{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Oe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ke=" \t\n\r=".split(""),Te=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<ke.length;e+=1)t[ke[e].charCodeAt(0)]=-2;for(let e=0;e<Oe.length;e+=1)t[Oe[e].charCodeAt(0)]=e;return t})();function je(t,e,r){if(null!==t)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const t=e.queue>>e.queuedBits-6&63;r(Oe[t]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const t=e.queue>>e.queuedBits-6&63;r(Oe[t]),e.queuedBits-=6}}function Ae(t,e,r){const i=Te[t];if(!(i>-1)){if(-2===i)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}for(e.queue=e.queue<<6|i,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8}function Ie(t){const e=[],r=t=>{e.push(String.fromCodePoint(t))},i={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},n=t=>{!function(t,e,r){if(0===e.utf8seq){if(t<=127)return void r(t);for(let r=1;r<6;r+=1)if(!(t>>7-r&1)){e.utf8seq=r;break}if(2===e.utf8seq)e.codepoint=31&t;else if(3===e.utf8seq)e.codepoint=15&t;else{if(4!==e.utf8seq)throw new Error("Invalid UTF-8 sequence");e.codepoint=7&t}e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|63&t,e.utf8seq-=1,0===e.utf8seq&&r(e.codepoint)}}(t,i,r)};for(let o=0;o<t.length;o+=1)Ae(t.charCodeAt(o),s,n);return e.join("")}function Re(t,e){if(!(t<=127)){if(t<=2047)return e(192|t>>6),void e(128|63&t);if(t<=65535)return e(224|t>>12),e(128|t>>6&63),void e(128|63&t);if(t<=1114111)return e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),void e(128|63&t);throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}e(t)}function Pe(t){const e=[],r={queue:0,queuedBits:0},i=t=>{e.push(t)};for(let s=0;s<t.length;s+=1)Ae(t.charCodeAt(s),r,i);return new Uint8Array(e)}function xe(t){const e=[];return function(t,e){for(let r=0;r<t.length;r+=1){let i=t.charCodeAt(r);if(i>55295&&i<=56319){const e=1024*(i-55296)&65535;i=65536+(t.charCodeAt(r+1)-56320&65535|e),r+=1}Re(i,e)}}(t,t=>e.push(t)),new Uint8Array(e)}function Ne(t){const e=[],r={queue:0,queuedBits:0},i=t=>{e.push(t)};return t.forEach(t=>je(t,r,i)),je(null,r,i),e.join("")}const Ue=()=>"undefined"!=typeof window&&"undefined"!=typeof document,Ce={tested:!1,writable:!1},De=()=>{if(!Ue())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(Ce.tested)return Ce.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Ce.tested=!0,Ce.writable=!0}catch(e){Ce.tested=!0,Ce.writable=!1}return Ce.writable};const Le=t=>t?(...e)=>t(...e):(...t)=>fetch(...t),Be=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},qe=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch(i){return r}},We=async(t,e)=>{await t.removeItem(e)};class Ge{constructor(){this.promise=new Ge.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}}function Je(t){const e=t.split(".");if(3!==e.length)throw new Se("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!he.test(e[r]))throw new Se("JWT not in base64url format");return{header:JSON.parse(Ie(e[0])),payload:JSON.parse(Ie(e[1])),signature:Pe(e[2]),raw:{header:e[0],payload:e[1]}}}function Fe(t){return("0"+t.toString(16)).substr(-2)}async function He(t){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return t;const e=await async function(t){const e=(new TextEncoder).encode(t),r=await crypto.subtle.digest("SHA-256",e),i=new Uint8Array(r);return Array.from(i).map(t=>String.fromCharCode(t)).join("")}(t);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ve(t,e,r=!1){const i=function(){const t=new Uint32Array(56);if("undefined"==typeof crypto){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",e=t.length;let r="";for(let i=0;i<56;i++)r+=t.charAt(Math.floor(Math.random()*e));return r}return crypto.getRandomValues(t),Array.from(t,Fe).join("")}();let s=i;r&&(s+="/PASSWORD_RECOVERY"),await Be(t,`${e}-code-verifier`,s);const n=await He(i);return[n,i===n?"plain":"s256"]}Ge.promiseConstructor=Promise;const Me=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const Ke=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ze(t){if(!Ke.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Ye(){return new Proxy({},{get:(t,e)=>{if("__isUserNotAvailableProxy"===e)return!0;if("symbol"==typeof e){const t=e.toString();if("Symbol(Symbol.toPrimitive)"===t||"Symbol(Symbol.toStringTag)"===t||"Symbol(util.inspect.custom)"===t)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${e}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Xe(t){return JSON.parse(JSON.stringify(t))}const Qe=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Ze=[502,503,504];async function tr(t){var e,r;if(!("object"==typeof(r=t)&&null!==r&&"status"in r&&"ok"in r&&"json"in r&&"function"==typeof r.json))throw new _e(Qe(t),0);if(Ze.includes(t.status))throw new _e(Qe(t),t.status);let i,s;try{i=await t.json()}catch(o){throw new de(Qe(o),o)}const n=function(t){const e=t.headers.get(oe);if(!e)return null;if(!e.match(Me))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch(o){return null}}(t);if(n&&n.getTime()>=ae.timestamp&&"object"==typeof i&&i&&"string"==typeof i.code?s=i.code:"object"==typeof i&&i&&"string"==typeof i.error_code&&(s=i.error_code),s){if("weak_password"===s)throw new Ee(Qe(i),t.status,(null===(e=i.weak_password)||void 0===e?void 0:e.reasons)||[]);if("session_not_found"===s)throw new we}else if("object"==typeof i&&i&&"object"==typeof i.weak_password&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce((t,e)=>t&&"string"==typeof e,!0))throw new Ee(Qe(i),t.status,i.weak_password.reasons);throw new ue(Qe(i),t.status||500,s)}async function er(t,e,r,i){var s;const n=Object.assign({},null==i?void 0:i.headers);n[oe]||(n[oe]=ae.name),(null==i?void 0:i.jwt)&&(n.Authorization=`Bearer ${i.jwt}`);const o=null!==(s=null==i?void 0:i.query)&&void 0!==s?s:{};(null==i?void 0:i.redirectTo)&&(o.redirect_to=i.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",h=await async function(t,e,r,i,s,n){const o=((t,e,r,i)=>{const s={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"===t?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==e?void 0:e.headers),s.body=JSON.stringify(i),Object.assign(Object.assign({},s),r))})(e,i,s,n);let a;try{a=await t(r,Object.assign({},o))}catch(h){throw new _e(Qe(h),0)}a.ok||await tr(a);if(null==i?void 0:i.noResolveJson)return a;try{return await a.json()}catch(h){await tr(h)}}(t,e,r+a,{headers:n,noResolveJson:null==i?void 0:i.noResolveJson},{},null==i?void 0:i.body);return(null==i?void 0:i.xform)?null==i?void 0:i.xform(h):{data:Object.assign({},h),error:null}}function rr(t){var e;let r=null;var i;(function(t){return t.access_token&&t.refresh_token&&t.expires_in})(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=(i=t.expires_in,Math.round(Date.now()/1e3)+i)));return{data:{session:r,user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function ir(t){const e=rr(t);return!e.error&&t.weak_password&&"object"==typeof t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&"string"==typeof t.weak_password.message&&t.weak_password.reasons.reduce((t,e)=>t&&"string"==typeof e,!0)&&(e.data.weak_password=t.weak_password),e}function sr(t){var e;return{data:{user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function nr(t){return{data:t,error:null}}function or(e){const{action_link:r,email_otp:i,hashed_token:s,redirect_to:n,verification_type:o}=e,a=t(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:r,email_otp:i,hashed_token:s,redirect_to:n,verification_type:o},user:Object.assign({},a)},error:null}}function ar(t){return t}const hr=["global","local","others"];class lr{constructor({url:t="",headers:e={},fetch:r}){this.url=t,this.headers=e,this.fetch=Le(r),this.mfa={listFactors:this.Nt.bind(this),deleteFactor:this.Ut.bind(this)},this.oauth={listClients:this.Ct.bind(this),createClient:this.Dt.bind(this),getClient:this.Lt.bind(this),updateClient:this.Bt.bind(this),deleteClient:this.qt.bind(this),regenerateClientSecret:this.Wt.bind(this)}}async signOut(t,e=hr[0]){if(hr.indexOf(e)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${hr.join(", ")}`);try{return await er(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ce(r))return{data:null,error:r};throw r}}async inviteUserByEmail(t,e={}){try{return await er(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:sr})}catch(r){if(ce(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:r}=e,i=t(e,["options"]),s=Object.assign(Object.assign({},i),r);return"newEmail"in i&&(s.new_email=null==i?void 0:i.newEmail,delete s.newEmail),await er(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:or,redirectTo:null==r?void 0:r.redirectTo})}catch(r){if(ce(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await er(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:sr})}catch(e){if(ce(e))return{data:{user:null},error:e};throw e}}async listUsers(t){var e,r,i,s,n,o,a;try{const h={nextPage:null,lastPage:0,total:0},l=await er(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(e=null==t?void 0:t.page)||void 0===e?void 0:e.toString())&&void 0!==r?r:"",per_page:null!==(s=null===(i=null==t?void 0:t.perPage)||void 0===i?void 0:i.toString())&&void 0!==s?s:""},xform:ar});if(l.error)throw l.error;const c=await l.json(),u=null!==(n=l.headers.get("x-total-count"))&&void 0!==n?n:0,d=null!==(a=null===(o=l.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach(t=>{const e=parseInt(t.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(t.split(";")[1].split("=")[1]);h[`${r}Page`]=e}),h.total=parseInt(u)),{data:Object.assign(Object.assign({},c),h),error:null}}catch(h){if(ce(h))return{data:{users:[]},error:h};throw h}}async getUserById(t){ze(t);try{return await er(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:sr})}catch(e){if(ce(e))return{data:{user:null},error:e};throw e}}async updateUserById(t,e){ze(t);try{return await er(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:sr})}catch(r){if(ce(r))return{data:{user:null},error:r};throw r}}async deleteUser(t,e=!1){ze(t);try{return await er(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:sr})}catch(r){if(ce(r))return{data:{user:null},error:r};throw r}}async Nt(t){ze(t.userId);try{const{data:e,error:r}=await er(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:t=>({data:{factors:t},error:null})});return{data:e,error:r}}catch(e){if(ce(e))return{data:null,error:e};throw e}}async Ut(t){ze(t.userId),ze(t.id);try{return{data:await er(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(ce(e))return{data:null,error:e};throw e}}async Ct(t){var e,r,i,s,n,o,a;try{const h={nextPage:null,lastPage:0,total:0},l=await er(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(e=null==t?void 0:t.page)||void 0===e?void 0:e.toString())&&void 0!==r?r:"",per_page:null!==(s=null===(i=null==t?void 0:t.perPage)||void 0===i?void 0:i.toString())&&void 0!==s?s:""},xform:ar});if(l.error)throw l.error;const c=await l.json(),u=null!==(n=l.headers.get("x-total-count"))&&void 0!==n?n:0,d=null!==(a=null===(o=l.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach(t=>{const e=parseInt(t.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(t.split(";")[1].split("=")[1]);h[`${r}Page`]=e}),h.total=parseInt(u)),{data:Object.assign(Object.assign({},c),h),error:null}}catch(h){if(ce(h))return{data:{clients:[]},error:h};throw h}}async Dt(t){try{return await er(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:t=>({data:t,error:null})})}catch(e){if(ce(e))return{data:null,error:e};throw e}}async Lt(t){try{return await er(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(e){if(ce(e))return{data:null,error:e};throw e}}async Bt(t,e){try{return await er(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(r){if(ce(r))return{data:null,error:r};throw r}}async qt(t){try{return await er(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(ce(e))return{data:null,error:e};throw e}}async Wt(t){try{return await er(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(e){if(ce(e))return{data:null,error:e};throw e}}}function cr(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}const ur=!!(globalThis&&De()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class dr extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class fr extends dr{}async function wr(t,e,r){const i=new globalThis.AbortController;return e>0&&setTimeout(()=>{i.abort()},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,0===e?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},async i=>{if(!i){if(0===e)throw new fr(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(ur)try{await globalThis.navigator.locks.query()}catch(s){}return await r()}try{return await r()}finally{}}))}function vr(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function yr(t){const e=(new TextEncoder).encode(t);return"0x"+Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}class pr extends Error{constructor({message:t,code:e,cause:r,name:i}){var s;super(t,{cause:r}),this.Gt=!0,this.name=null!==(s=null!=i?i:r instanceof Error?r.name:void 0)&&void 0!==s?s:"Unknown Error",this.code=e}}class br extends pr{constructor(t,e){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e,message:t}),this.name="WebAuthnUnknownError",this.originalError=e}}function mr({error:t,options:e}){var r,i,s;const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if("AbortError"===t.name){if(e.signal instanceof AbortSignal)return new pr({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if("ConstraintError"===t.name){if(!0===(null===(r=n.authenticatorSelection)||void 0===r?void 0:r.requireResidentKey))return new pr({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if("conditional"===e.mediation&&"required"===(null===(i=n.authenticatorSelection)||void 0===i?void 0:i.userVerification))return new pr({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if("required"===(null===(s=n.authenticatorSelection)||void 0===s?void 0:s.userVerification))return new pr({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if("InvalidStateError"===t.name)return new pr({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if("NotAllowedError"===t.name)return new pr({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if("NotSupportedError"===t.name){return 0===n.pubKeyCredParams.filter(t=>"public-key"===t.type).length?new pr({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new pr({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t})}if("SecurityError"===t.name){const e=window.location.hostname;if(!kr(e))return new pr({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t});if(n.rp.id!==e)return new pr({message:`The RP ID "${n.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else if("TypeError"===t.name){if(n.user.id.byteLength<1||n.user.id.byteLength>64)return new pr({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if("UnknownError"===t.name)return new pr({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new pr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function gr({error:t,options:e}){const{publicKey:r}=e;if(!r)throw Error("options was missing required publicKey property");if("AbortError"===t.name){if(e.signal instanceof AbortSignal)return new pr({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if("NotAllowedError"===t.name)return new pr({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if("SecurityError"===t.name){const e=window.location.hostname;if(!kr(e))return new pr({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t});if(r.rpId!==e)return new pr({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else if("UnknownError"===t.name)return new pr({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new pr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}const _r=new class{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}};function $r(e){if(!e)throw new Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:r,user:i,excludeCredentials:s}=e,n=t(e,["challenge","user","excludeCredentials"]),o=Pe(r).buffer,a=Object.assign(Object.assign({},i),{id:Pe(i.id).buffer}),h=Object.assign(Object.assign({},n),{challenge:o,user:a});if(s&&s.length>0){h.excludeCredentials=new Array(s.length);for(let t=0;t<s.length;t++){const e=s[t];h.excludeCredentials[t]=Object.assign(Object.assign({},e),{id:Pe(e.id).buffer,type:e.type||"public-key",transports:e.transports})}}return h}function Er(e){if(!e)throw new Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:r,allowCredentials:i}=e,s=t(e,["challenge","allowCredentials"]),n=Pe(r).buffer,o=Object.assign(Object.assign({},s),{challenge:n});if(i&&i.length>0){o.allowCredentials=new Array(i.length);for(let t=0;t<i.length;t++){const e=i[t];o.allowCredentials[t]=Object.assign(Object.assign({},e),{id:Pe(e.id).buffer,type:e.type||"public-key",transports:e.transports})}}return o}function Sr(t){var e;if("toJSON"in t&&"function"==typeof t.toJSON)return t.toJSON();const r=t;return{id:t.id,rawId:t.id,response:{attestationObject:Ne(new Uint8Array(t.response.attestationObject)),clientDataJSON:Ne(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:null!==(e=r.authenticatorAttachment)&&void 0!==e?e:void 0}}function Or(t){var e;if("toJSON"in t&&"function"==typeof t.toJSON)return t.toJSON();const r=t,i=t.getClientExtensionResults(),s=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Ne(new Uint8Array(s.authenticatorData)),clientDataJSON:Ne(new Uint8Array(s.clientDataJSON)),signature:Ne(new Uint8Array(s.signature)),userHandle:s.userHandle?Ne(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:i,authenticatorAttachment:null!==(e=r.authenticatorAttachment)&&void 0!==e?e:void 0}}function kr(t){return"localhost"===t||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function Tr(){var t,e;return!!(Ue()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.create)&&"function"==typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.get))}const jr={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},Ar={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Ir(...t){const e=t=>null!==t&&"object"==typeof t&&!Array.isArray(t),r=t=>t instanceof ArrayBuffer||ArrayBuffer.isView(t),i={};for(const s of t)if(s)for(const t in s){const n=s[t];if(void 0!==n)if(Array.isArray(n))i[t]=n;else if(r(n))i[t]=n;else if(e(n)){const r=i[t];e(r)?i[t]=Ir(r,n):i[t]=Ir(n)}else i[t]=n}return i}class Rr{constructor(t){this.client=t,this.enroll=this.Jt.bind(this),this.challenge=this.Ft.bind(this),this.verify=this.Ht.bind(this),this.authenticate=this.Vt.bind(this),this.register=this.Mt.bind(this)}async Jt(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async Ft({factorId:t,webauthn:e,friendlyName:r,signal:i},s){var n;try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:t,webauthn:e});if(!o)return{data:null,error:a};const h=null!=i?i:_r.createNewAbortSignal();if("create"===o.webauthn.type){const{user:t}=o.webauthn.credential_options.publicKey;if(!t.name){const e=r;if(e)t.name=`${t.id}:${e}`;else{const e=(await this.client.getUser()).data.user,r=(null===(n=null==e?void 0:e.user_metadata)||void 0===n?void 0:n.name)||(null==e?void 0:e.email)||(null==e?void 0:e.id)||"User";t.name=`${t.id}:${r}`}}t.displayName||(t.displayName=t.name)}switch(o.webauthn.type){case"create":{const e=function(t,e){return Ir(jr,t,e||{})}(o.webauthn.credential_options.publicKey,null==s?void 0:s.create),{data:r,error:i}=await async function(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new br("Browser returned unexpected credential type",e)}:{data:null,error:new br("Empty credential response",e)}}catch(e){return{data:null,error:mr({error:e,options:t})}}}({publicKey:e,signal:h});return r?{data:{factorId:t,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:r}},error:null}:{data:null,error:i}}case"request":{const e=function(t,e){return Ir(Ar,t,e||{})}(o.webauthn.credential_options.publicKey,null==s?void 0:s.request),{data:r,error:i}=await async function(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new br("Browser returned unexpected credential type",e)}:{data:null,error:new br("Empty credential response",e)}}catch(e){return{data:null,error:gr({error:e,options:t})}}}(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:e,signal:h}));return r?{data:{factorId:t,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:r}},error:null}:{data:null,error:i}}}}catch(o){return ce(o)?{data:null,error:o}:{data:null,error:new de("Unexpected error in challenge",o)}}}async Ht({challengeId:t,factorId:e,webauthn:r}){return this.client.mfa.verify({factorId:e,challengeId:t,webauthn:r})}async Vt({factorId:t,webauthn:{rpId:e=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:r=("undefined"!=typeof window?[window.location.origin]:void 0),signal:i}={}},s){if(!e)return{data:null,error:new le("rpId is required for WebAuthn authentication")};try{if(!Tr())return{data:null,error:new de("Browser does not support WebAuthn",null)};const{data:n,error:o}=await this.challenge({factorId:t,webauthn:{rpId:e,rpOrigins:r},signal:i},{request:s});if(!n)return{data:null,error:o};const{webauthn:a}=n;return this.Ht({factorId:t,challengeId:n.challengeId,webauthn:{type:a.type,rpId:e,rpOrigins:r,credential_response:a.credential_response}})}catch(n){return ce(n)?{data:null,error:n}:{data:null,error:new de("Unexpected error in authenticate",n)}}}async Mt({friendlyName:t,webauthn:{rpId:e=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:r=("undefined"!=typeof window?[window.location.origin]:void 0),signal:i}={}},s){if(!e)return{data:null,error:new le("rpId is required for WebAuthn registration")};try{if(!Tr())return{data:null,error:new de("Browser does not support WebAuthn",null)};const{data:n,error:o}=await this.Jt({friendlyName:t});if(!n)return await this.client.mfa.listFactors().then(e=>{var r;return null===(r=e.data)||void 0===r?void 0:r.all.find(e=>"webauthn"===e.factor_type&&e.friendly_name===t&&"unverified"!==e.status)}).then(t=>t?this.client.mfa.unenroll({factorId:null==t?void 0:t.id}):void 0),{data:null,error:o};const{data:a,error:h}=await this.Ft({factorId:n.id,friendlyName:n.friendly_name,webauthn:{rpId:e,rpOrigins:r},signal:i},{create:s});return a?this.Ht({factorId:n.id,challengeId:a.challengeId,webauthn:{rpId:e,rpOrigins:r,type:a.webauthn.type,credential_response:a.webauthn.credential_response}}):{data:null,error:h}}catch(n){return ce(n)?{data:null,error:n}:{data:null,error:new de("Unexpected error in register",n)}}}}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"Kt",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.Kt}catch(t){"undefined"!=typeof self&&(self.globalThis=self)}}();const Pr={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ne,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function xr(t,e,r){return await r()}const Nr={};class Ur{get jwks(){var t,e;return null!==(e=null===(t=Nr[this.storageKey])||void 0===t?void 0:t.jwks)&&void 0!==e?e:{keys:[]}}set jwks(t){Nr[this.storageKey]=Object.assign(Object.assign({},Nr[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,e;return null!==(e=null===(t=Nr[this.storageKey])||void 0===t?void 0:t.cachedAt)&&void 0!==e?e:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Nr[this.storageKey]=Object.assign(Object.assign({},Nr[this.storageKey]),{cachedAt:t})}constructor(t){var e,r,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const s=Object.assign(Object.assign({},Pr),t);if(this.storageKey=s.storageKey,this.instanceID=null!==(e=Ur.nextInstanceID[this.storageKey])&&void 0!==e?e:0,Ur.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.instanceID>0&&Ue()){this.zt();this.logDebugMessages}if(this.persistSession=s.persistSession,this.autoRefreshToken=s.autoRefreshToken,this.admin=new lr({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Le(s.fetch),this.lock=s.lock||xr,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,this.throwOnError=s.throwOnError,this.lockAcquireTimeout=s.lockAcquireTimeout,s.lock?this.lock=s.lock:this.persistSession&&Ue()&&(null===(r=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===r?void 0:r.locks)?this.lock=wr:this.lock=xr,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this.Ht.bind(this),enroll:this.Jt.bind(this),unenroll:this.Yt.bind(this),challenge:this.Ft.bind(this),listFactors:this.Nt.bind(this),challengeAndVerify:this.Xt.bind(this),getAuthenticatorAssuranceLevel:this.Qt.bind(this),webauthn:new Rr(this)},this.oauth={getAuthorizationDetails:this.Zt.bind(this),approveAuthorization:this.te.bind(this),denyAuthorization:this.ee.bind(this),listGrants:this.re.bind(this),revokeGrant:this.ie.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:De()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=cr(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=cr(this.memoryStorage)),Ue()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){}null===(i=this.broadcastChannel)||void 0===i||i.addEventListener("message",async t=>{this.se("received broadcast notification from other tab or client",t);try{await this.ne(t.data.event,t.data.session,!1)}catch(e){this.se("#broadcastChannel","error",e)}})}this.initialize().catch(t=>{this.se("#initialize()","error",t)})}isThrowOnErrorEnabled(){return this.throwOnError}oe(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}zt(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${re}) ${(new Date).toISOString()}`}se(...t){return this.logDebugMessages&&this.logger(this.zt(),...t),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this.ae(this.lockAcquireTimeout,async()=>await this.he()))()),await this.initializePromise}async he(){var t;try{let e={},r="none";if(Ue()&&(e=function(t){const e={},r=new URL(t);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((t,r)=>{e[r]=t})}catch(i){}return r.searchParams.forEach((t,r)=>{e[r]=t}),e}(window.location.href),this.le(e)?r="implicit":await this.ce(e)&&(r="pkce")),Ue()&&this.detectSessionInUrl&&"none"!==r){const{data:i,error:s}=await this.ue(e,r);if(s){if(this.se("#_initialize()","error detecting session from URL",s),function(t){return ce(t)&&"AuthImplicitGrantRedirectError"===t.name}(s)){const e=null===(t=s.details)||void 0===t?void 0:t.code;if("identity_already_exists"===e||"identity_not_found"===e||"single_identity_not_deletable"===e)return{error:s}}return{error:s}}const{session:n,redirectType:o}=i;return this.se("#_initialize()","detected session in URL",n,"redirect type",o),await this.de(n),setTimeout(async()=>{"recovery"===o?await this.ne("PASSWORD_RECOVERY",n):await this.ne("SIGNED_IN",n)},0),{error:null}}return await this.fe(),{error:null}}catch(e){return ce(e)?this.oe({error:e}):this.oe({error:new de("Unexpected error during initialization",e)})}finally{await this.we(),this.se("#_initialize()","end")}}async signInAnonymously(t){var e,r,i;try{const s=await er(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(r=null===(e=null==t?void 0:t.options)||void 0===e?void 0:e.data)&&void 0!==r?r:{},gotrue_meta_security:{captcha_token:null===(i=null==t?void 0:t.options)||void 0===i?void 0:i.captchaToken}},xform:rr}),{data:n,error:o}=s;if(o||!n)return this.oe({data:{user:null,session:null},error:o});const a=n.session,h=n.user;return n.session&&(await this.de(n.session),await this.ne("SIGNED_IN",a)),this.oe({data:{user:h,session:a},error:null})}catch(s){if(ce(s))return this.oe({data:{user:null,session:null},error:s});throw s}}async signUp(t){var e,r,i;try{let s;if("email"in t){const{email:r,password:i,options:n}=t;let o=null,a=null;"pkce"===this.flowType&&([o,a]=await Ve(this.storage,this.storageKey)),s=await er(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==n?void 0:n.emailRedirectTo,body:{email:r,password:i,data:null!==(e=null==n?void 0:n.data)&&void 0!==e?e:{},gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:o,code_challenge_method:a},xform:rr})}else{if(!("phone"in t))throw new pe("You must provide either an email or phone number and a password");{const{phone:e,password:n,options:o}=t;s=await er(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:e,password:n,data:null!==(r=null==o?void 0:o.data)&&void 0!==r?r:{},channel:null!==(i=null==o?void 0:o.channel)&&void 0!==i?i:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:rr})}}const{data:n,error:o}=s;if(o||!n)return await We(this.storage,`${this.storageKey}-code-verifier`),this.oe({data:{user:null,session:null},error:o});const a=n.session,h=n.user;return n.session&&(await this.de(n.session),await this.ne("SIGNED_IN",a)),this.oe({data:{user:h,session:a},error:null})}catch(s){if(await We(this.storage,`${this.storageKey}-code-verifier`),ce(s))return this.oe({data:{user:null,session:null},error:s});throw s}}async signInWithPassword(t){try{let e;if("email"in t){const{email:r,password:i,options:s}=t;e=await er(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:i,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},xform:ir})}else{if(!("phone"in t))throw new pe("You must provide either an email or phone number and a password");{const{phone:r,password:i,options:s}=t;e=await er(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:i,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},xform:ir})}}const{data:r,error:i}=e;if(i)return this.oe({data:{user:null,session:null},error:i});if(!r||!r.session||!r.user){const t=new ye;return this.oe({data:{user:null,session:null},error:t})}return r.session&&(await this.de(r.session),await this.ne("SIGNED_IN",r.session)),this.oe({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:i})}catch(e){if(ce(e))return this.oe({data:{user:null,session:null},error:e});throw e}}async signInWithOAuth(t){var e,r,i,s;return await this.ve(t.provider,{redirectTo:null===(e=t.options)||void 0===e?void 0:e.redirectTo,scopes:null===(r=t.options)||void 0===r?void 0:r.scopes,queryParams:null===(i=t.options)||void 0===i?void 0:i.queryParams,skipBrowserRedirect:null===(s=t.options)||void 0===s?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this.ae(this.lockAcquireTimeout,async()=>this.ye(t))}async signInWithWeb3(t){const{chain:e}=t;switch(e){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${e}"`)}}async signInWithEthereum(t){var e,r,i,s,n,o,a,h,l,c,u;let d,f;if("message"in t)d=t.message,f=t.signature;else{const{chain:c,wallet:u,statement:w,options:v}=t;let y;if(Ue())if("object"==typeof u)y=u;else{const t=window;if(!("ethereum"in t)||"object"!=typeof t.ethereum||!("request"in t.ethereum)||"function"!=typeof t.ethereum.request)throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.");y=t.ethereum}else{if("object"!=typeof u||!(null==v?void 0:v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=u}const p=new URL(null!==(e=null==v?void 0:v.url)&&void 0!==e?e:window.location.href),b=await y.request({method:"eth_requestAccounts"}).then(t=>t).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!b||0===b.length)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const m=vr(b[0]);let g=null===(r=null==v?void 0:v.signInWithEthereum)||void 0===r?void 0:r.chainId;if(!g){const t=await y.request({method:"eth_chainId"});g=parseInt(t,16)}d=function(t){var e;const{chainId:r,domain:i,expirationTime:s,issuedAt:n=new Date,nonce:o,notBefore:a,requestId:h,resources:l,scheme:c,uri:u,version:d}=t;if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!i)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!u)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==d)throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${d}`);if(null===(e=t.statement)||void 0===e?void 0:e.includes("\n"))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`);const f=`${c?`${c}://${i}`:i} wants you to sign in with your Ethereum account:\n${vr(t.address)}\n\n${t.statement?`${t.statement}\n`:""}`;let w=`URI: ${u}\nVersion: ${d}\nChain ID: ${r}${o?`\nNonce: ${o}`:""}\nIssued At: ${n.toISOString()}`;if(s&&(w+=`\nExpiration Time: ${s.toISOString()}`),a&&(w+=`\nNot Before: ${a.toISOString()}`),h&&(w+=`\nRequest ID: ${h}`),l){let t="\nResources:";for(const e of l){if(!e||"string"!=typeof e)throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${e}`);t+=`\n- ${e}`}w+=t}return`${f}\n${w}`}({domain:p.host,address:m,statement:w,uri:p.href,version:"1",chainId:g,nonce:null===(i=null==v?void 0:v.signInWithEthereum)||void 0===i?void 0:i.nonce,issuedAt:null!==(n=null===(s=null==v?void 0:v.signInWithEthereum)||void 0===s?void 0:s.issuedAt)&&void 0!==n?n:new Date,expirationTime:null===(o=null==v?void 0:v.signInWithEthereum)||void 0===o?void 0:o.expirationTime,notBefore:null===(a=null==v?void 0:v.signInWithEthereum)||void 0===a?void 0:a.notBefore,requestId:null===(h=null==v?void 0:v.signInWithEthereum)||void 0===h?void 0:h.requestId,resources:null===(l=null==v?void 0:v.signInWithEthereum)||void 0===l?void 0:l.resources}),f=await y.request({method:"personal_sign",params:[yr(d),m]})}try{const{data:e,error:r}=await er(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:d,signature:f},(null===(c=t.options)||void 0===c?void 0:c.captchaToken)?{gotrue_meta_security:{captcha_token:null===(u=t.options)||void 0===u?void 0:u.captchaToken}}:null),xform:rr});if(r)throw r;if(!e||!e.session||!e.user){const t=new ye;return this.oe({data:{user:null,session:null},error:t})}return e.session&&(await this.de(e.session),await this.ne("SIGNED_IN",e.session)),this.oe({data:Object.assign({},e),error:r})}catch(w){if(ce(w))return this.oe({data:{user:null,session:null},error:w});throw w}}async signInWithSolana(t){var e,r,i,s,n,o,a,h,l,c,u,d;let f,w;if("message"in t)f=t.message,w=t.signature;else{const{chain:u,wallet:d,statement:v,options:y}=t;let p;if(Ue())if("object"==typeof d)p=d;else{const t=window;if(!("solana"in t)||"object"!=typeof t.solana||!("signIn"in t.solana&&"function"==typeof t.solana.signIn||"signMessage"in t.solana&&"function"==typeof t.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");p=t.solana}else{if("object"!=typeof d||!(null==y?void 0:y.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");p=d}const b=new URL(null!==(e=null==y?void 0:y.url)&&void 0!==e?e:window.location.href);if("signIn"in p&&p.signIn){const t=await p.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==y?void 0:y.signInWithSolana),{version:"1",domain:b.host,uri:b.href}),v?{statement:v}:null));let e;if(Array.isArray(t)&&t[0]&&"object"==typeof t[0])e=t[0];else{if(!(t&&"object"==typeof t&&"signedMessage"in t&&"signature"in t))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");e=t}if(!("signedMessage"in e&&"signature"in e&&("string"==typeof e.signedMessage||e.signedMessage instanceof Uint8Array)&&e.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");f="string"==typeof e.signedMessage?e.signedMessage:(new TextDecoder).decode(e.signedMessage),w=e.signature}else{if(!("signMessage"in p&&"function"==typeof p.signMessage&&"publicKey"in p&&"object"==typeof p&&p.publicKey&&"toBase58"in p.publicKey&&"function"==typeof p.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${b.host} wants you to sign in with your Solana account:`,p.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${b.href}`,`Issued At: ${null!==(i=null===(r=null==y?void 0:y.signInWithSolana)||void 0===r?void 0:r.issuedAt)&&void 0!==i?i:(new Date).toISOString()}`,...(null===(s=null==y?void 0:y.signInWithSolana)||void 0===s?void 0:s.notBefore)?[`Not Before: ${y.signInWithSolana.notBefore}`]:[],...(null===(n=null==y?void 0:y.signInWithSolana)||void 0===n?void 0:n.expirationTime)?[`Expiration Time: ${y.signInWithSolana.expirationTime}`]:[],...(null===(o=null==y?void 0:y.signInWithSolana)||void 0===o?void 0:o.chainId)?[`Chain ID: ${y.signInWithSolana.chainId}`]:[],...(null===(a=null==y?void 0:y.signInWithSolana)||void 0===a?void 0:a.nonce)?[`Nonce: ${y.signInWithSolana.nonce}`]:[],...(null===(h=null==y?void 0:y.signInWithSolana)||void 0===h?void 0:h.requestId)?[`Request ID: ${y.signInWithSolana.requestId}`]:[],...(null===(c=null===(l=null==y?void 0:y.signInWithSolana)||void 0===l?void 0:l.resources)||void 0===c?void 0:c.length)?["Resources",...y.signInWithSolana.resources.map(t=>`- ${t}`)]:[]].join("\n");const t=await p.signMessage((new TextEncoder).encode(f),"utf8");if(!(t&&t instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");w=t}}try{const{data:e,error:r}=await er(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:Ne(w)},(null===(u=t.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=t.options)||void 0===d?void 0:d.captchaToken}}:null),xform:rr});if(r)throw r;if(!e||!e.session||!e.user){const t=new ye;return this.oe({data:{user:null,session:null},error:t})}return e.session&&(await this.de(e.session),await this.ne("SIGNED_IN",e.session)),this.oe({data:Object.assign({},e),error:r})}catch(v){if(ce(v))return this.oe({data:{user:null,session:null},error:v});throw v}}async ye(t){const e=await qe(this.storage,`${this.storageKey}-code-verifier`),[r,i]=(null!=e?e:"").split("/");try{if(!r&&"pkce"===this.flowType)throw new ge;const{data:e,error:s}=await er(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:r},xform:rr});if(await We(this.storage,`${this.storageKey}-code-verifier`),s)throw s;if(!e||!e.session||!e.user){const t=new ye;return this.oe({data:{user:null,session:null,redirectType:null},error:t})}return e.session&&(await this.de(e.session),await this.ne("SIGNED_IN",e.session)),this.oe({data:Object.assign(Object.assign({},e),{redirectType:null!=i?i:null}),error:s})}catch(s){if(await We(this.storage,`${this.storageKey}-code-verifier`),ce(s))return this.oe({data:{user:null,session:null,redirectType:null},error:s});throw s}}async signInWithIdToken(t){try{const{options:e,provider:r,token:i,access_token:s,nonce:n}=t,o=await er(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:i,access_token:s,nonce:n,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},xform:rr}),{data:a,error:h}=o;if(h)return this.oe({data:{user:null,session:null},error:h});if(!a||!a.session||!a.user){const t=new ye;return this.oe({data:{user:null,session:null},error:t})}return a.session&&(await this.de(a.session),await this.ne("SIGNED_IN",a.session)),this.oe({data:a,error:h})}catch(e){if(ce(e))return this.oe({data:{user:null,session:null},error:e});throw e}}async signInWithOtp(t){var e,r,i,s,n;try{if("email"in t){const{email:i,options:s}=t;let n=null,o=null;"pkce"===this.flowType&&([n,o]=await Ve(this.storage,this.storageKey));const{error:a}=await er(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:i,data:null!==(e=null==s?void 0:s.data)&&void 0!==e?e:{},create_user:null===(r=null==s?void 0:s.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},code_challenge:n,code_challenge_method:o},redirectTo:null==s?void 0:s.emailRedirectTo});return this.oe({data:{user:null,session:null},error:a})}if("phone"in t){const{phone:e,options:r}=t,{data:o,error:a}=await er(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:e,data:null!==(i=null==r?void 0:r.data)&&void 0!==i?i:{},create_user:null===(s=null==r?void 0:r.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(n=null==r?void 0:r.channel)&&void 0!==n?n:"sms"}});return this.oe({data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a})}throw new pe("You must provide either an email or phone number.")}catch(o){if(await We(this.storage,`${this.storageKey}-code-verifier`),ce(o))return this.oe({data:{user:null,session:null},error:o});throw o}}async verifyOtp(t){var e,r;try{let i,s;"options"in t&&(i=null===(e=t.options)||void 0===e?void 0:e.redirectTo,s=null===(r=t.options)||void 0===r?void 0:r.captchaToken);const{data:n,error:o}=await er(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:s}}),redirectTo:i,xform:rr});if(o)throw o;if(!n){throw new Error("An error occurred on token verification.")}const a=n.session,h=n.user;return(null==a?void 0:a.access_token)&&(await this.de(a),await this.ne("recovery"==t.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),this.oe({data:{user:h,session:a},error:null})}catch(i){if(ce(i))return this.oe({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(t){var e,r,i,s,n;try{let o=null,a=null;"pkce"===this.flowType&&([o,a]=await Ve(this.storage,this.storageKey));const h=await er(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:null!==(r=null===(e=t.options)||void 0===e?void 0:e.redirectTo)&&void 0!==r?r:void 0}),(null===(i=null==t?void 0:t.options)||void 0===i?void 0:i.captchaToken)?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:a}),headers:this.headers,xform:nr});return(null===(s=h.data)||void 0===s?void 0:s.url)&&Ue()&&!(null===(n=t.options)||void 0===n?void 0:n.skipBrowserRedirect)&&window.location.assign(h.data.url),this.oe(h)}catch(o){if(await We(this.storage,`${this.storageKey}-code-verifier`),ce(o))return this.oe({data:null,error:o});throw o}}async reauthenticate(){return await this.initializePromise,await this.ae(this.lockAcquireTimeout,async()=>await this.pe())}async pe(){try{return await this.be(async t=>{const{data:{session:e},error:r}=t;if(r)throw r;if(!e)throw new we;const{error:i}=await er(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return this.oe({data:{user:null,session:null},error:i})})}catch(t){if(ce(t))return this.oe({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const e=`${this.url}/resend`;if("email"in t){const{email:r,type:i,options:s}=t,{error:n}=await er(this.fetch,"POST",e,{headers:this.headers,body:{email:r,type:i,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},redirectTo:null==s?void 0:s.emailRedirectTo});return this.oe({data:{user:null,session:null},error:n})}if("phone"in t){const{phone:r,type:i,options:s}=t,{data:n,error:o}=await er(this.fetch,"POST",e,{headers:this.headers,body:{phone:r,type:i,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}}});return this.oe({data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:o})}throw new pe("You must provide either an email or phone number and a type")}catch(e){if(ce(e))return this.oe({data:{user:null,session:null},error:e});throw e}}async getSession(){await this.initializePromise;return await this.ae(this.lockAcquireTimeout,async()=>this.be(async t=>t))}async ae(t,e){this.se("#_acquireLock","begin",t);try{if(this.lockAcquired){const t=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await t,await e()))();return this.pendingInLock.push((async()=>{try{await r}catch(t){}})()),r}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this.se("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const t=e();for(this.pendingInLock.push((async()=>{try{await t}catch(e){}})()),await t;this.pendingInLock.length;){const t=[...this.pendingInLock];await Promise.all(t),this.pendingInLock.splice(0,t.length)}return await t}finally{this.se("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this.se("#_acquireLock","end")}}async be(t){this.se("#_useSession","begin");try{const e=await this.me();return await t(e)}finally{this.se("#_useSession","end")}}async me(){this.se("#__loadSession()","begin"),this.lockAcquired||this.se("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let t=null;const e=await qe(this.storage,this.storageKey);if(this.se("#getSession()","session from storage",e),null!==e&&(this.ge(e)?t=e:(this.se("#getSession()","session from storage is not valid"),await this._e())),!t)return{data:{session:null},error:null};const r=!!t.expires_at&&1e3*t.expires_at-Date.now()<se;if(this.se("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",t.expires_at),!r){if(this.userStorage){const e=await qe(this.userStorage,this.storageKey+"-user");(null==e?void 0:e.user)?t.user=e.user:t.user=Ye()}if(this.storage.isServer&&t.user&&!t.user.$e){const e={value:this.suppressGetSessionWarning};t.user=function(t,e){return new Proxy(t,{get:(t,r,i)=>{if("__isInsecureUserWarningProxy"===r)return!0;if("symbol"==typeof r){const e=r.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e||"Symbol(nodejs.util.inspect.custom)"===e)return Reflect.get(t,r,i)}return e.value||"string"!=typeof r||(e.value=!0),Reflect.get(t,r,i)}})}(t.user,e),e.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:i,error:s}=await this.Ee(t.refresh_token);return s?this.oe({data:{session:null},error:s}):this.oe({data:{session:i},error:null})}finally{this.se("#__loadSession()","end")}}async getUser(t){if(t)return await this.Se(t);await this.initializePromise;const e=await this.ae(this.lockAcquireTimeout,async()=>await this.Se());return e.data.user&&(this.suppressGetSessionWarning=!0),e}async Se(t){try{return t?await er(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:sr}):await this.be(async t=>{var e,r,i;const{data:s,error:n}=t;if(n)throw n;return(null===(e=s.session)||void 0===e?void 0:e.access_token)||this.hasCustomAuthorizationHeader?await er(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(i=null===(r=s.session)||void 0===r?void 0:r.access_token)&&void 0!==i?i:void 0,xform:sr}):{data:{user:null},error:new we}})}catch(e){if(ce(e))return ve(e)&&(await this._e(),await We(this.storage,`${this.storageKey}-code-verifier`)),this.oe({data:{user:null},error:e});throw e}}async updateUser(t,e={}){return await this.initializePromise,await this.ae(this.lockAcquireTimeout,async()=>await this.Oe(t,e))}async Oe(t,e={}){try{return await this.be(async r=>{const{data:i,error:s}=r;if(s)throw s;if(!i.session)throw new we;const n=i.session;let o=null,a=null;"pkce"===this.flowType&&null!=t.email&&([o,a]=await Ve(this.storage,this.storageKey));const{data:h,error:l}=await er(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==e?void 0:e.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:a}),jwt:n.access_token,xform:sr});if(l)throw l;return n.user=h.user,await this.de(n),await this.ne("USER_UPDATED",n),this.oe({data:{user:n.user},error:null})})}catch(r){if(await We(this.storage,`${this.storageKey}-code-verifier`),ce(r))return this.oe({data:{user:null},error:r});throw r}}async setSession(t){return await this.initializePromise,await this.ae(this.lockAcquireTimeout,async()=>await this.ke(t))}async ke(t){try{if(!t.access_token||!t.refresh_token)throw new we;const e=Date.now()/1e3;let r=e,i=!0,s=null;const{payload:n}=Je(t.access_token);if(n.exp&&(r=n.exp,i=r<=e),i){const{data:e,error:r}=await this.Ee(t.refresh_token);if(r)return this.oe({data:{user:null,session:null},error:r});if(!e)return{data:{user:null,session:null},error:null};s=e}else{const{data:i,error:n}=await this.Se(t.access_token);if(n)return this.oe({data:{user:null,session:null},error:n});s={access_token:t.access_token,refresh_token:t.refresh_token,user:i.user,token_type:"bearer",expires_in:r-e,expires_at:r},await this.de(s),await this.ne("SIGNED_IN",s)}return this.oe({data:{user:s.user,session:s},error:null})}catch(e){if(ce(e))return this.oe({data:{session:null,user:null},error:e});throw e}}async refreshSession(t){return await this.initializePromise,await this.ae(this.lockAcquireTimeout,async()=>await this.Te(t))}async Te(t){try{return await this.be(async e=>{var r;if(!t){const{data:i,error:s}=e;if(s)throw s;t=null!==(r=i.session)&&void 0!==r?r:void 0}if(!(null==t?void 0:t.refresh_token))throw new we;const{data:i,error:s}=await this.Ee(t.refresh_token);return s?this.oe({data:{user:null,session:null},error:s}):i?this.oe({data:{user:i.user,session:i},error:null}):this.oe({data:{user:null,session:null},error:null})})}catch(e){if(ce(e))return this.oe({data:{user:null,session:null},error:e});throw e}}async ue(t,e){try{if(!Ue())throw new be("No browser detected.");if(t.error||t.error_description||t.error_code)throw new be(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(e){case"implicit":if("pkce"===this.flowType)throw new me("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new be("Not a valid implicit grant flow url.")}if("pkce"===e){if(this.se("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new me("No code detected.");const{data:e,error:r}=await this.ye(t.code);if(r)throw r;const i=new URL(window.location.href);return i.searchParams.delete("code"),window.history.replaceState(window.history.state,"",i.toString()),{data:{session:e.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:i,access_token:s,refresh_token:n,expires_in:o,expires_at:a,token_type:h}=t;if(!(s&&o&&n&&h))throw new be("No session defined in URL");const l=Math.round(Date.now()/1e3),c=parseInt(o);let u=l+c;a&&(u=parseInt(a));const{data:d,error:f}=await this.Se(s);if(f)throw f;const w={provider_token:r,provider_refresh_token:i,access_token:s,expires_in:c,expires_at:u,refresh_token:n,token_type:h,user:d.user};return window.location.hash="",this.se("#_getSessionFromURL()","clearing window.location.hash"),this.oe({data:{session:w,redirectType:t.type},error:null})}catch(r){if(ce(r))return this.oe({data:{session:null,redirectType:null},error:r});throw r}}le(t){return"function"==typeof this.detectSessionInUrl?this.detectSessionInUrl(new URL(window.location.href),t):Boolean(t.access_token||t.error_description)}async ce(t){const e=await qe(this.storage,`${this.storageKey}-code-verifier`);return!(!t.code||!e)}async signOut(t={scope:"global"}){return await this.initializePromise,await this.ae(this.lockAcquireTimeout,async()=>await this.je(t))}async je({scope:t}={scope:"global"}){return await this.be(async e=>{var r;const{data:i,error:s}=e;if(s&&!ve(s))return this.oe({error:s});const n=null===(r=i.session)||void 0===r?void 0:r.access_token;if(n){const{error:e}=await this.admin.signOut(n,t);if(e&&(!function(t){return ce(t)&&"AuthApiError"===t.name}(e)||404!==e.status&&401!==e.status&&403!==e.status)&&!ve(e))return this.oe({error:e})}return"others"!==t&&(await this._e(),await We(this.storage,`${this.storageKey}-code-verifier`)),this.oe({error:null})})}onAuthStateChange(t){const e=Symbol("auth-callback"),r={id:e,callback:t,unsubscribe:()=>{this.se("#unsubscribe()","state change callback with id removed",e),this.stateChangeEmitters.delete(e)}};return this.se("#onAuthStateChange()","registered callback with id",e),this.stateChangeEmitters.set(e,r),(async()=>{await this.initializePromise,await this.ae(this.lockAcquireTimeout,async()=>{this.Ae(e)})})(),{data:{subscription:r}}}async Ae(t){return await this.be(async e=>{var r,i;try{const{data:{session:i},error:s}=e;if(s)throw s;await(null===(r=this.stateChangeEmitters.get(t))||void 0===r?void 0:r.callback("INITIAL_SESSION",i)),this.se("INITIAL_SESSION","callback id",t,"session",i)}catch(s){await(null===(i=this.stateChangeEmitters.get(t))||void 0===i?void 0:i.callback("INITIAL_SESSION",null)),this.se("INITIAL_SESSION","callback id",t,"error",s)}})}async resetPasswordForEmail(t,e={}){let r=null,i=null;"pkce"===this.flowType&&([r,i]=await Ve(this.storage,this.storageKey,!0));try{return await er(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:r,code_challenge_method:i,gotrue_meta_security:{captcha_token:e.captchaToken}},headers:this.headers,redirectTo:e.redirectTo})}catch(s){if(await We(this.storage,`${this.storageKey}-code-verifier`),ce(s))return this.oe({data:null,error:s});throw s}}async getUserIdentities(){var t;try{const{data:e,error:r}=await this.getUser();if(r)throw r;return this.oe({data:{identities:null!==(t=e.user.identities)&&void 0!==t?t:[]},error:null})}catch(e){if(ce(e))return this.oe({data:null,error:e});throw e}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var e;try{const{data:r,error:i}=await this.be(async e=>{var r,i,s,n,o;const{data:a,error:h}=e;if(h)throw h;const l=await this.Ie(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:null===(r=t.options)||void 0===r?void 0:r.redirectTo,scopes:null===(i=t.options)||void 0===i?void 0:i.scopes,queryParams:null===(s=t.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:!0});return await er(this.fetch,"GET",l,{headers:this.headers,jwt:null!==(o=null===(n=a.session)||void 0===n?void 0:n.access_token)&&void 0!==o?o:void 0})});if(i)throw i;return Ue()&&!(null===(e=t.options)||void 0===e?void 0:e.skipBrowserRedirect)&&window.location.assign(null==r?void 0:r.url),this.oe({data:{provider:t.provider,url:null==r?void 0:r.url},error:null})}catch(r){if(ce(r))return this.oe({data:{provider:t.provider,url:null},error:r});throw r}}async linkIdentityIdToken(t){return await this.be(async e=>{var r;try{const{error:i,data:{session:s}}=e;if(i)throw i;const{options:n,provider:o,token:a,access_token:h,nonce:l}=t,c=await er(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!==(r=null==s?void 0:s.access_token)&&void 0!==r?r:void 0,body:{provider:o,id_token:a,access_token:h,nonce:l,link_identity:!0,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:rr}),{data:u,error:d}=c;return d?this.oe({data:{user:null,session:null},error:d}):u&&u.session&&u.user?(u.session&&(await this.de(u.session),await this.ne("USER_UPDATED",u.session)),this.oe({data:u,error:d})):this.oe({data:{user:null,session:null},error:new ye})}catch(i){if(await We(this.storage,`${this.storageKey}-code-verifier`),ce(i))return this.oe({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(t){try{return await this.be(async e=>{var r,i;const{data:s,error:n}=e;if(n)throw n;return await er(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:null!==(i=null===(r=s.session)||void 0===r?void 0:r.access_token)&&void 0!==i?i:void 0})})}catch(e){if(ce(e))return this.oe({data:null,error:e});throw e}}async Re(t){const e=`#_refreshAccessToken(${t.substring(0,5)}...)`;this.se(e,"begin");try{const s=Date.now();return await(r=async r=>(r>0&&await async function(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}(200*Math.pow(2,r-1)),this.se(e,"refreshing attempt",r),await er(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:rr})),i=(t,e)=>{const r=200*Math.pow(2,t);return e&&$e(e)&&Date.now()+r-s<ie},new Promise((t,e)=>{(async()=>{for(let n=0;n<1/0;n++)try{const e=await r(n);if(!i(n,null,e))return void t(e)}catch(s){if(!i(n,s))return void e(s)}})()}))}catch(s){if(this.se(e,"error",s),ce(s))return this.oe({data:{session:null,user:null},error:s});throw s}finally{this.se(e,"end")}var r,i}ge(t){return"object"==typeof t&&null!==t&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async ve(t,e){const r=await this.Ie(`${this.url}/authorize`,t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});return this.se("#_handleProviderSignIn()","provider",t,"options",e,"url",r),Ue()&&!e.skipBrowserRedirect&&window.location.assign(r),{data:{provider:t,url:r},error:null}}async fe(){var t,e;const r="#_recoverAndRefresh()";this.se(r,"begin");try{const s=await qe(this.storage,this.storageKey);if(s&&this.userStorage){let e=await qe(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||e||(e={user:s.user},await Be(this.userStorage,this.storageKey+"-user",e)),s.user=null!==(t=null==e?void 0:e.user)&&void 0!==t?t:Ye()}else if(s&&!s.user&&!s.user){const t=await qe(this.storage,this.storageKey+"-user");t&&(null==t?void 0:t.user)?(s.user=t.user,await We(this.storage,this.storageKey+"-user"),await Be(this.storage,this.storageKey,s)):s.user=Ye()}if(this.se(r,"session from storage",s),!this.ge(s))return this.se(r,"session is not valid"),void(null!==s&&await this._e());const n=1e3*(null!==(e=s.expires_at)&&void 0!==e?e:1/0)-Date.now()<se;if(this.se(r,`session has${n?"":" not"} expired with margin of 90000s`),n){if(this.autoRefreshToken&&s.refresh_token){const{error:t}=await this.Ee(s.refresh_token);t&&($e(t)||(this.se(r,"refresh failed with a non-retryable error, removing the session",t),await this._e()))}}else if(s.user&&!0===s.user.$e)try{const{data:t,error:e}=await this.Se(s.access_token);!e&&(null==t?void 0:t.user)?(s.user=t.user,await this.de(s),await this.ne("SIGNED_IN",s)):this.se(r,"could not get user data, skipping SIGNED_IN notification")}catch(i){this.se(r,"error getting user data, skipping SIGNED_IN notification",i)}else await this.ne("SIGNED_IN",s)}catch(s){return void this.se(r,"error",s)}finally{this.se(r,"end")}}async Ee(t){var e,r;if(!t)throw new we;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${t.substring(0,5)}...)`;this.se(i,"begin");try{this.refreshingDeferred=new Ge;const{data:e,error:r}=await this.Re(t);if(r)throw r;if(!e.session)throw new we;await this.de(e.session),await this.ne("TOKEN_REFRESHED",e.session);const i={data:e.session,error:null};return this.refreshingDeferred.resolve(i),i}catch(s){if(this.se(i,"error",s),ce(s)){const t={data:null,error:s};return $e(s)||await this._e(),null===(e=this.refreshingDeferred)||void 0===e||e.resolve(t),t}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(s),s}finally{this.refreshingDeferred=null,this.se(i,"end")}}async ne(t,e,r=!0){const i=`#_notifyAllSubscribers(${t})`;this.se(i,"begin",e,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:t,session:e});const i=[],s=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(t,e)}catch(s){i.push(s)}});if(await Promise.all(s),i.length>0){for(let t=0;t<i.length;t+=1);throw i[0]}}finally{this.se(i,"end")}}async de(t){this.se("#_saveSession()",t),this.suppressGetSessionWarning=!0,await We(this.storage,`${this.storageKey}-code-verifier`);const e=Object.assign({},t),r=e.user&&!0===e.user.$e;if(this.userStorage){!r&&e.user&&await Be(this.userStorage,this.storageKey+"-user",{user:e.user});const t=Object.assign({},e);delete t.user;const i=Xe(t);await Be(this.storage,this.storageKey,i)}else{const t=Xe(e);await Be(this.storage,this.storageKey,t)}}async _e(){this.se("#_removeSession()"),this.suppressGetSessionWarning=!1,await We(this.storage,this.storageKey),await We(this.storage,this.storageKey+"-code-verifier"),await We(this.storage,this.storageKey+"-user"),this.userStorage&&await We(this.userStorage,this.storageKey+"-user"),await this.ne("SIGNED_OUT",null)}Pe(){this.se("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Ue()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(e){}}async xe(){await this.Ne(),this.se("#_startAutoRefresh()");const t=setInterval(()=>this.Ue(),ie);this.autoRefreshTicker=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t);const e=setTimeout(async()=>{await this.initializePromise,await this.Ue()},0);this.autoRefreshTickTimeout=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e)}async Ne(){this.se("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t);const e=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,e&&clearTimeout(e)}async startAutoRefresh(){this.Pe(),await this.xe()}async stopAutoRefresh(){this.Pe(),await this.Ne()}async Ue(){this.se("#_autoRefreshTokenTick()","begin");try{await this.ae(0,async()=>{try{const e=Date.now();try{return await this.be(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at)return void this.se("#_autoRefreshTokenTick()","no session");const i=Math.floor((1e3*r.expires_at-e)/ie);this.se("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),i<=3&&await this.Ee(r.refresh_token)})}catch(t){}}finally{this.se("#_autoRefreshTokenTick()","end")}})}catch(t){if(!(t.isAcquireTimeout||t instanceof dr))throw t;this.se("auto refresh token tick lock not available")}}async we(){if(this.se("#_handleVisibilityChange()"),!Ue()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this.Ce(!1)}catch(t){this.se("#visibilityChangedCallback","error",t)}},null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this.Ce(!0)}catch(t){}}async Ce(t){const e=`#_onVisibilityChanged(${t})`;this.se(e,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this.xe(),t||(await this.initializePromise,await this.ae(this.lockAcquireTimeout,async()=>{"visible"===document.visibilityState?await this.fe():this.se(e,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this.Ne()}async Ie(t,e,r){const i=[`provider=${encodeURIComponent(e)}`];if((null==r?void 0:r.redirectTo)&&i.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),(null==r?void 0:r.scopes)&&i.push(`scopes=${encodeURIComponent(r.scopes)}`),"pkce"===this.flowType){const[t,e]=await Ve(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(t)}`,code_challenge_method:`${encodeURIComponent(e)}`});i.push(r.toString())}if(null==r?void 0:r.queryParams){const t=new URLSearchParams(r.queryParams);i.push(t.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&i.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${t}?${i.join("&")}`}async Yt(t){try{return await this.be(async e=>{var r;const{data:i,error:s}=e;return s?this.oe({data:null,error:s}):await er(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:null===(r=null==i?void 0:i.session)||void 0===r?void 0:r.access_token})})}catch(e){if(ce(e))return this.oe({data:null,error:e});throw e}}async Jt(t){try{return await this.be(async e=>{var r,i;const{data:s,error:n}=e;if(n)return this.oe({data:null,error:n});const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},"phone"===t.factorType?{phone:t.phone}:"totp"===t.factorType?{issuer:t.issuer}:{}),{data:a,error:h}=await er(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});return h?this.oe({data:null,error:h}):("totp"===t.factorType&&"totp"===a.type&&(null===(i=null==a?void 0:a.totp)||void 0===i?void 0:i.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),this.oe({data:a,error:null}))})}catch(e){if(ce(e))return this.oe({data:null,error:e});throw e}}async Ht(t){return this.ae(this.lockAcquireTimeout,async()=>{try{return await this.be(async e=>{var r;const{data:i,error:s}=e;if(s)return this.oe({data:null,error:s});const n=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:"create"===t.webauthn.type?Sr(t.webauthn.credential_response):Or(t.webauthn.credential_response)})}:{code:t.code}),{data:o,error:a}=await er(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:n,headers:this.headers,jwt:null===(r=null==i?void 0:i.session)||void 0===r?void 0:r.access_token});return a?this.oe({data:null,error:a}):(await this.de(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this.ne("MFA_CHALLENGE_VERIFIED",o),this.oe({data:o,error:a}))})}catch(e){if(ce(e))return this.oe({data:null,error:e});throw e}})}async Ft(t){return this.ae(this.lockAcquireTimeout,async()=>{try{return await this.be(async e=>{var r;const{data:i,error:s}=e;if(s)return this.oe({data:null,error:s});const n=await er(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:null===(r=null==i?void 0:i.session)||void 0===r?void 0:r.access_token});if(n.error)return n;const{data:o}=n;if("webauthn"!==o.type)return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:$r(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Er(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(ce(e))return this.oe({data:null,error:e});throw e}})}async Xt(t){const{data:e,error:r}=await this.Ft({factorId:t.factorId});return r?this.oe({data:null,error:r}):await this.Ht({factorId:t.factorId,challengeId:e.id,code:t.code})}async Nt(){var t;const{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};const i={all:[],phone:[],totp:[],webauthn:[]};for(const s of null!==(t=null==e?void 0:e.factors)&&void 0!==t?t:[])i.all.push(s),"verified"===s.status&&i[s.factor_type].push(s);return{data:i,error:null}}async Qt(t){var e,r,i,s;if(t)try{const{payload:i}=Je(t);let s=null;i.aal&&(s=i.aal);let n=s;const{data:{user:o},error:a}=await this.getUser(t);if(a)return this.oe({data:null,error:a});(null!==(r=null===(e=null==o?void 0:o.factors)||void 0===e?void 0:e.filter(t=>"verified"===t.status))&&void 0!==r?r:[]).length>0&&(n="aal2");return{data:{currentLevel:s,nextLevel:n,currentAuthenticationMethods:i.amr||[]},error:null}}catch(c){if(ce(c))return this.oe({data:null,error:c});throw c}const{data:{session:n},error:o}=await this.getSession();if(o)return this.oe({data:null,error:o});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=Je(n.access_token);let h=null;a.aal&&(h=a.aal);let l=h;(null!==(s=null===(i=n.user.factors)||void 0===i?void 0:i.filter(t=>"verified"===t.status))&&void 0!==s?s:[]).length>0&&(l="aal2");return{data:{currentLevel:h,nextLevel:l,currentAuthenticationMethods:a.amr||[]},error:null}}async Zt(t){try{return await this.be(async e=>{const{data:{session:r},error:i}=e;return i?this.oe({data:null,error:i}):r?await er(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:r.access_token,xform:t=>({data:t,error:null})}):this.oe({data:null,error:new we})})}catch(e){if(ce(e))return this.oe({data:null,error:e});throw e}}async te(t,e){try{return await this.be(async r=>{const{data:{session:i},error:s}=r;if(s)return this.oe({data:null,error:s});if(!i)return this.oe({data:null,error:new we});const n=await er(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:t=>({data:t,error:null})});return n.data&&n.data.redirect_url&&Ue()&&!(null==e?void 0:e.skipBrowserRedirect)&&window.location.assign(n.data.redirect_url),n})}catch(r){if(ce(r))return this.oe({data:null,error:r});throw r}}async ee(t,e){try{return await this.be(async r=>{const{data:{session:i},error:s}=r;if(s)return this.oe({data:null,error:s});if(!i)return this.oe({data:null,error:new we});const n=await er(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:t=>({data:t,error:null})});return n.data&&n.data.redirect_url&&Ue()&&!(null==e?void 0:e.skipBrowserRedirect)&&window.location.assign(n.data.redirect_url),n})}catch(r){if(ce(r))return this.oe({data:null,error:r});throw r}}async re(){try{return await this.be(async t=>{const{data:{session:e},error:r}=t;return r?this.oe({data:null,error:r}):e?await er(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:e.access_token,xform:t=>({data:t,error:null})}):this.oe({data:null,error:new we})})}catch(t){if(ce(t))return this.oe({data:null,error:t});throw t}}async ie(t){try{return await this.be(async e=>{const{data:{session:r},error:i}=e;return i?this.oe({data:null,error:i}):r?(await er(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this.oe({data:null,error:new we})})}catch(e){if(ce(e))return this.oe({data:null,error:e});throw e}}async fetchJwk(t,e={keys:[]}){let r=e.keys.find(e=>e.kid===t);if(r)return r;const i=Date.now();if(r=this.jwks.keys.find(e=>e.kid===t),r&&this.jwks_cached_at+6e5>i)return r;const{data:s,error:n}=await er(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(n)throw n;return s.keys&&0!==s.keys.length?(this.jwks=s,this.jwks_cached_at=i,r=s.keys.find(e=>e.kid===t),r||null):null}async getClaims(t,e={}){try{let r=t;if(!r){const{data:t,error:e}=await this.getSession();if(e||!t.session)return this.oe({data:null,error:e});r=t.session.access_token}const{header:i,payload:s,signature:n,raw:{header:o,payload:a}}=Je(r);(null==e?void 0:e.allowExpired)||function(t){if(!t)throw new Error("Missing exp claim");if(t<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(s.exp);const h=i.alg&&!i.alg.startsWith("HS")&&i.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(i.kid,(null==e?void 0:e.keys)?{keys:e.keys}:null==e?void 0:e.jwks):null;if(!h){const{error:t}=await this.getUser(r);if(t)throw t;return{data:{claims:s,header:i,signature:n},error:null}}const l=function(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(i.alg),c=await crypto.subtle.importKey("jwk",h,l,!0,["verify"]);if(!(await crypto.subtle.verify(l,c,n,xe(`${o}.${a}`))))throw new Se("Invalid JWT signature");return{data:{claims:s,header:i,signature:n},error:null}}catch(r){if(ce(r))return this.oe({data:null,error:r});throw r}}}Ur.nextInstanceID={};const Cr=Ur;let Dr="";Dr="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Lr={headers:{"X-Client-Info":`supabase-js-${Dr}/2.94.1`}},Br={schema:"public"},qr={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Wr={};function Gr(t){return(Gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Jr(t){var e=function(t,e){if("object"!=Gr(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e);if("object"!=Gr(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Gr(e)?e:e+""}function Fr(t,e,r){return(e=Jr(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Hr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,i)}return r}function Vr(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Hr(Object(r),!0).forEach(function(e){Fr(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Hr(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}const Mr=(t,e,r)=>{const i=(t=>t?(...e)=>t(...e):(...t)=>fetch(...t))(r),s=Headers;return async(r,n)=>{var o;const a=null!==(o=await e())&&void 0!==o?o:t;let h=new s(null==n?void 0:n.headers);return h.has("apikey")||h.set("apikey",t),h.has("Authorization")||h.set("Authorization",`Bearer ${a}`),i(r,Vr(Vr({},n),{},{headers:h}))}};var Kr=class extends Cr{constructor(t){super(t)}},zr=class{constructor(t,e,r){var i,s;this.supabaseUrl=t,this.supabaseKey=e;const n=function(t){const e=null==t?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((r=e).endsWith("/")?r:r+"/")}catch(i){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var r}(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",n),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",n),this.storageUrl=new URL("storage/v1",n),this.functionsUrl=new URL("functions/v1",n);const o=`sb-${n.hostname.split(".")[0]}-auth-token`,a=function(t,e){var r,i;const{db:s,auth:n,realtime:o,global:a}=t,{db:h,auth:l,realtime:c,global:u}=e,d={db:Vr(Vr({},h),s),auth:Vr(Vr({},l),n),realtime:Vr(Vr({},c),o),storage:{},global:Vr(Vr(Vr({},u),a),{},{headers:Vr(Vr({},null!==(r=null==u?void 0:u.headers)&&void 0!==r?r:{}),null!==(i=null==a?void 0:a.headers)&&void 0!==i?i:{})}),accessToken:async()=>""};return t.accessToken?d.accessToken=t.accessToken:delete d.accessToken,d}(null!=r?r:{},{db:Br,realtime:Wr,auth:Vr(Vr({},qr),{},{storageKey:o}),global:Lr});var h;(this.storageKey=null!==(i=a.auth.storageKey)&&void 0!==i?i:"",this.headers=null!==(s=a.global.headers)&&void 0!==s?s:{},a.accessToken)?(this.accessToken=a.accessToken,this.auth=new Proxy({},{get:(t,e)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(e)} is not possible`)}})):this.auth=this.De(null!==(h=a.auth)&&void 0!==h?h:{},this.headers,a.global.fetch);this.fetch=Mr(e,this.Le.bind(this),a.global.fetch),this.realtime=this.Be(Vr({headers:this.headers,accessToken:this.Le.bind(this)},a.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(t=>this.realtime.setAuth(t)).catch(t=>{}),this.rest=new g(new URL("rest/v1",n).href,{headers:this.headers,schema:a.db.schema,fetch:this.fetch,timeout:a.db.timeout,urlLengthLimit:a.db.urlLengthLimit}),this.storage=new ee(this.storageUrl.href,this.headers,this.fetch,null==r?void 0:r.storage),a.accessToken||this.qe()}get functions(){return new h(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,r)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async Le(){var t,e,r=this;if(r.accessToken)return await r.accessToken();const{data:i}=await r.auth.getSession();return null!==(t=null===(e=i.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:r.supabaseKey}De({autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:i,userStorage:s,storageKey:n,flowType:o,lock:a,debug:h,throwOnError:l},c,u){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Kr({url:this.authUrl.href,headers:Vr(Vr({},d),c),storageKey:n,autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:i,userStorage:s,flowType:o,lock:a,debug:h,throwOnError:l,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(t=>"authorization"===t.toLowerCase())})}Be(t){return new ct(this.realtimeUrl.href,Vr(Vr({},t),{},{params:Vr(Vr({},{apikey:this.supabaseKey}),null==t?void 0:t.params)}))}qe(){return this.auth.onAuthStateChange((t,e)=>{this.We(t,"CLIENT",null==e?void 0:e.access_token)})}We(t,e,r){"TOKEN_REFRESHED"!==t&&"SIGNED_IN"!==t||this.changedAccessToken===r?"SIGNED_OUT"===t&&(this.realtime.setAuth(),"STORAGE"==e&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=r,this.realtime.setAuth(r))}};const Yr=(t,e,r)=>new zr(t,e,r);!function(){if("undefined"!=typeof window)return!1;const t=globalThis.process;if(!t)return!1;const e=t.version;if(null==e)return!1;const r=e.match(/^v(\d+)\./);!!r&&parseInt(r[1],10)}();export{Yr as c};
