import{j as e,m,d as ie,T as ne,e as le,Z as ce,H as me,t as de,i as xe,F as ue,V as pe,u as he,A as J}from"./DXSTB80B.js";import{u as ge,d as fe,r as n}from"./gFfKhp4p.js";import{s as g,u as be,g as d}from"./uetzOJTg.js";import{g as U}from"./BSdRGNX3.js";import{l as we,c as ve,s as V,u as ye,g as je}from"./DUqNDSdr.js";import"./DqliOerU.js";const Ne={async getFeed(r=20,a=0){const{data:t,error:s}=await g.from("posts").select(`
        *,
        user:profiles!posts_user_id_fkey(id, username, avatar_url, avatar_color, level, league),
        opponent:profiles!posts_opponent_id_fkey(id, username, avatar_url, avatar_color)
      `).eq("is_public",!0).order("created_at",{ascending:!1}).range(a,a+r-1);if(s)throw s;return t||[]},async getUserFeed(r,a=20){const{data:t,error:s}=await g.from("posts").select(`
        *,
        user:profiles!posts_user_id_fkey(id, username, avatar_url, avatar_color, level, league),
        opponent:profiles!posts_opponent_id_fkey(id, username, avatar_url, avatar_color)
      `).eq("user_id",r).order("created_at",{ascending:!1}).limit(a);if(s)throw s;return t||[]},async postQuizResult(r,a,t,s,f,p){const{data:b,error:l}=await g.from("posts").insert({user_id:r,type:"result",category:a,score:t,is_victory:s,opponent_id:f,opponent_score:p}).select().single();if(l)throw l;return b},async postAchievement(r,a){const{data:t,error:s}=await g.from("posts").insert({user_id:r,type:"achievement",achievement_id:a}).select().single();if(s)throw s;return t},async postLevelUp(r,a){const{data:t,error:s}=await g.from("posts").insert({user_id:r,type:"level_up",new_level:a}).select().single();if(s)throw s;return t},async postLeagueUp(r,a){const{data:t,error:s}=await g.from("posts").insert({user_id:r,type:"league_up",new_league:a}).select().single();if(s)throw s;return t},async createChallenge(r,a,t="medium",s){const{data:f,error:p}=await g.from("challenges").insert({challenger_id:r,challenged_id:s,category:a,difficulty:t}).select().single();if(p)throw p;return await g.from("posts").insert({user_id:r,type:"challenge",challenge_category:a,challenge_difficulty:t}),f},async likePost(r,a){const{error:t}=await g.from("post_likes").insert({post_id:r,user_id:a});if(t&&!t.message.includes("duplicate"))throw t},async unlikePost(r,a){const{error:t}=await g.from("post_likes").delete().eq("post_id",r).eq("user_id",a);if(t)throw t},async isPostLiked(r,a){const{data:t}=await g.from("post_likes").select("id").eq("post_id",r).eq("user_id",a).single();return!!t},async getComments(r){const{data:a,error:t}=await g.from("post_comments").select(`
        *,
        user:profiles(id, username, avatar_url, avatar_color)
      `).eq("post_id",r).order("created_at",{ascending:!0});if(t)throw t;return a||[]},async addComment(r,a,t){const{data:s,error:f}=await g.from("post_comments").insert({post_id:r,user_id:a,content:t}).select(`
        *,
        user:profiles(id, username, avatar_url, avatar_color)
      `).single();if(f)throw f;return s},async deleteComment(r){const{error:a}=await g.from("post_comments").delete().eq("id",r);if(a)throw a}},h={basePoints:{easy:5,medium:7,hard:10},timeBonus:{fast:{threshold:10,bonus:5},good:{threshold:7,bonus:3},ok:{threshold:4,bonus:1}},streakBonus:{3:1,5:2,7:3,10:5},xp:{correctAnswer:10,perfectAnswer:15,streak5:20,streak10:50}};function _e(r,a,t,s){const f=h.basePoints[a];let p=0,b="ok";t>=h.timeBonus.fast.threshold?(p=h.timeBonus.fast.bonus,b="perfect"):t>=h.timeBonus.good.threshold?(p=h.timeBonus.good.bonus,b="great"):t>=h.timeBonus.ok.threshold&&(p=h.timeBonus.ok.bonus,b="good");let l=0;s>=10?l=h.streakBonus[10]:s>=7?l=h.streakBonus[7]:s>=5?l=h.streakBonus[5]:s>=3&&(l=h.streakBonus[3]);const A=f+p+l;let w=h.xp.correctAnswer;b==="perfect"&&(w=h.xp.perfectAnswer),s===5&&(w+=h.xp.streak5),s===10&&(w+=h.xp.streak10);const S={perfect:["Parfait ! ðŸ”¥","Incroyable ! âš¡","LÃ©gendaire ! ðŸ‘‘"],great:["Excellent ! âœ¨","Super ! ðŸŒŸ","Bien jouÃ© ! ðŸ’ª"],good:["Correct ! âœ“","Bien ! ðŸ‘","Continue ! ðŸŽ¯"],ok:["Juste Ã  temps ! â±ï¸","De justesse ! ðŸ˜…","Ouf ! ðŸ˜®â€ðŸ’¨"]},_=S[b]||S.ok,B=_[Math.floor(Math.random()*_.length)];return{basePoints:f,timeBonus:p,streakBonus:l,totalPoints:A,xpGained:w,message:B,grade:b}}const ke={rap:d("/images/questions/bg_rap.png"),football:d("/images/questions/bg_football.png"),"football-africain":d("/images/questions/bg_football.png"),manga:d("/images/questions/bg_manga.png"),netflix:d("/images/questions/bg_netflix.png"),crypto:d("/images/questions/bg_crypto.png"),kpop:d("/images/questions/bg_kpop.png"),afrobeats:d("/images/questions/bg_afrobeats.png"),nba:d("/images/questions/bg_nba.png"),marvel:d("/images/questions/bg_marvel.png"),gaming:d("/images/questions/bg_gaming.png"),"gaming-pro":d("/images/questions/bg_gaming.png"),tiktok:d("/images/questions/bg_tiktok.png"),afrique:d("/images/questions/bg_afrique.png"),youtube:d("/images/questions/bg_youtube.png"),mode:d("/images/questions/bg_mode.png"),celebrites:d("/images/questions/bg_celebrites.png")};function Pe(){const r=ge(),a=fe(),{category:t,categoryName:s,gameMode:f}=a.state||{},[p,b]=n.useState("loading"),[l,A]=n.useState([]),[w,S]=n.useState(0),[_,B]=n.useState(0),[G,R]=n.useState(0),[j,L]=n.useState(15),[P,z]=n.useState(null),[y,$]=n.useState(!1),[M,F]=n.useState(0),[I,O]=n.useState(1),[c,D]=n.useState(null),[Z,W]=n.useState(0),[Y,K]=n.useState(!1),[ee]=n.useState(Date.now()),[te,se]=n.useState(!1),[X,ae]=n.useState(!0),{user:H}=be(),k=f==="solo"?20:15,q=10,T=n.useMemo(()=>{if(!t)return null;const i=t.toLowerCase().replace(/\s+/g,"-");return ke[i]||null},[t]);n.useEffect(()=>{let i=we();i||(i=ve("Joueur"+Math.floor(Math.random()*1e4)),V(i)),D(i);const o=t?U(t,q):U("sport",q);A(o),L(k),b("playing")},[t,q,k]),n.useEffect(()=>{if(p!=="playing"||y)return;const i=setInterval(()=>{L(o=>o<=1?(Q(-1),k):o-1)},1e3);return()=>clearInterval(i)},[p,y,k]);const Q=n.useCallback(i=>{if(y||P!==null)return;z(i),$(!0);const o=l[w],N=i===(o==null?void 0:o.correct);if(N){const v=_e(!0,o.difficulty,j,M+1);B(u=>u+v.totalPoints),R(u=>u+1),F(u=>u+1),O(u=>Math.min(u+.5,3))}else F(0),O(1);setTimeout(()=>{w+1<l.length?(S(v=>v+1),L(k),z(null),$(!1)):re(N)},1500)},[y,P,l,w,j,I,k]),re=i=>{const o=G+(i?1:0),N=Math.floor((Date.now()-ee)/1e3),v=o>=l.length/2,u={category:s||"GÃ©nÃ©ral",score:_,correctAnswers:o,totalQuestions:l.length,timeSpent:N,isWin:v,isDuel:f==="random"||f==="ranked"};if(c){const C=c.level,E=ye(c,u),oe=E.totalXp-c.totalXp;W(oe),E.level>C&&K(!0),V(E),D(E)}if(b("result"),H)try{Ne.postQuizResult(H.id,s||t||"General",_,v,void 0,void 0)}catch(C){console.error("Erreur partage resultat:",C)}},x=l[w];if(p==="loading")return e.jsx("div",{className:"min-h-screen min-h-[100dvh] bg-gradient-to-br from-slate-950 via-purple-950 to-slate-950 flex items-center justify-center safe-area-inset",children:e.jsxs(m.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"text-center px-4",children:[e.jsxs("div",{className:"w-20 h-20 sm:w-24 sm:h-24 mx-auto mb-6 relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-violet-500/30 animate-ping"}),e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-t-violet-500 border-r-fuchsia-500 border-b-cyan-500 border-l-transparent animate-spin"}),e.jsx("img",{src:d("/images/logo/Logo_Principal_Neon.png"),alt:"Loading",className:"absolute inset-2 w-16 h-16 sm:w-20 sm:h-20 object-contain"})]}),e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-white mb-2",children:"Chargement..."}),e.jsx("p",{className:"text-white/60 text-sm sm:text-base",children:s||"Quiz GÃ©nÃ©ral"})]})});if(p==="result"){const i=Math.round(G/l.length*100),o=i>=80?"S":i>=60?"A":i>=40?"B":"C",N={S:"from-yellow-400 to-orange-500",A:"from-green-400 to-emerald-500",B:"from-blue-400 to-cyan-500",C:"from-gray-400 to-gray-500"},v={S:"LÃ‰GENDAIRE !",A:"EXCELLENT !",B:"BIEN JOUÃ‰ !",C:"Continue !"};return e.jsxs("div",{className:"min-h-screen min-h-[100dvh] flex items-center justify-center p-4 safe-area-inset relative overflow-hidden",style:{backgroundImage:T?`url(${T})`:void 0,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-slate-950/90 via-purple-950/80 to-slate-950/90"}),e.jsxs(m.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"text-center max-w-md w-full relative z-10",children:[Y&&e.jsx(m.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},className:"mb-4 sm:mb-6",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full text-black font-bold text-sm sm:text-base",children:[e.jsx(ie,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"NIVEAU ",c==null?void 0:c.level," ATTEINT !"]})}),e.jsx(m.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.2},className:`w-24 h-24 sm:w-32 sm:h-32 mx-auto mb-4 sm:mb-6 rounded-full bg-gradient-to-br ${N[o]} flex items-center justify-center shadow-2xl`,children:e.jsx("span",{className:"text-5xl sm:text-6xl font-black text-white",children:o})}),e.jsx("h2",{className:"text-2xl sm:text-3xl font-black text-white mb-2",children:v[o]}),e.jsx("p",{className:"text-white/60 mb-4 sm:mb-6 text-sm sm:text-base",children:s||"Quiz GÃ©nÃ©ral"}),e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white/5 backdrop-blur-md rounded-2xl p-4 sm:p-6 mb-4 sm:mb-6 border border-white/10",children:[e.jsx("div",{className:"text-4xl sm:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-fuchsia-400 mb-2",children:_.toLocaleString()}),e.jsx("div",{className:"text-white/60 text-sm sm:text-base",children:"POINTS"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4 mb-4 sm:mb-6",children:[e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-white/5 backdrop-blur-md rounded-xl p-3 sm:p-4 border border-white/10",children:[e.jsx(ne,{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-400 mx-auto mb-1"}),e.jsxs("div",{className:"text-lg sm:text-xl font-bold text-white",children:[G,"/",l.length]}),e.jsx("div",{className:"text-white/50 text-xs",children:"Correct"})]}),e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"bg-white/5 backdrop-blur-md rounded-xl p-3 sm:p-4 border border-white/10",children:[e.jsx(le,{className:"w-4 h-4 sm:w-5 sm:h-5 text-cyan-400 mx-auto mb-1"}),e.jsxs("div",{className:"text-lg sm:text-xl font-bold text-white",children:[i,"%"]}),e.jsx("div",{className:"text-white/50 text-xs",children:"PrÃ©cision"})]}),e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"bg-white/5 backdrop-blur-md rounded-xl p-3 sm:p-4 border border-white/10",children:[e.jsx(ce,{className:"w-4 h-4 sm:w-5 sm:h-5 text-yellow-400 mx-auto mb-1"}),e.jsxs("div",{className:"text-lg sm:text-xl font-bold text-white",children:["+",Z]}),e.jsx("div",{className:"text-white/50 text-xs",children:"XP"})]})]}),c&&e.jsxs(m.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"bg-white/5 backdrop-blur-md rounded-xl p-3 sm:p-4 mb-4 sm:mb-6 border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-gradient-to-br ${c.avatarColor} flex items-center justify-center font-bold text-white text-sm sm:text-base`,children:c.avatar}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-white font-medium text-sm sm:text-base",children:c.username}),e.jsxs("div",{className:"text-white/50 text-xs sm:text-sm",children:["Niveau ",c.level]})]})]}),e.jsx("img",{src:je(c.league),alt:c.league,className:"w-8 h-8 sm:w-10 sm:h-10 object-contain"})]}),e.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-fuchsia-500 rounded-full transition-all duration-1000",style:{width:`${c.xp/c.xpToNextLevel*100}%`}})}),e.jsxs("div",{className:"text-white/50 text-xs mt-1 text-right",children:[c.xp,"/",c.xpToNextLevel," XP"]})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-4",children:[e.jsx(m.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{b("loading"),S(0),B(0),R(0),F(0),O(1),z(null),$(!1);const u=t?U(t,q):U("sport",q);A(u),L(k),setTimeout(()=>b("playing"),500)},className:"flex-1 px-4 sm:px-6 py-3 sm:py-4 bg-gradient-to-r from-violet-600 to-fuchsia-600 rounded-xl text-white font-bold shadow-lg shadow-violet-500/50 text-sm sm:text-base",children:"REJOUER"}),e.jsx(m.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>r("/"),className:"px-4 sm:px-6 py-3 sm:py-4 bg-white/10 rounded-xl text-white font-bold border border-white/20",children:e.jsx(me,{className:"w-4 h-4 sm:w-5 sm:h-5 mx-auto"})}),e.jsx(m.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{se(!0);const u=`J'ai obtenu ${_} points en ${s||"Quiz"} sur QQUIZ PRODIGY ! ${i}% de bonnes reponses. Tu peux faire mieux ?`;navigator.share?navigator.share({title:"QQUIZ PRODIGY",text:u,url:"https://qquizz-mvp1.vercel.app"}):navigator.clipboard.writeText(u+" https://qquizz-mvp1.vercel.app")},className:`px-4 sm:px-6 py-3 sm:py-4 rounded-xl text-white font-bold ${te?"bg-green-500/20 border border-green-500/50":"bg-cyan-500/20 border border-cyan-500/50"}`,children:e.jsx(de,{className:"w-4 h-4 sm:w-5 sm:h-5 mx-auto"})})]})]})]})}return e.jsxs("div",{className:"min-h-screen min-h-[100dvh] flex flex-col safe-area-inset relative overflow-hidden",style:{backgroundImage:T?`url(${T})`:void 0,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-slate-950/80 via-purple-950/70 to-slate-950/80"}),e.jsxs("div",{className:"relative z-10 flex flex-col flex-1",children:[e.jsxs("div",{className:"p-3 sm:p-4 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>r("/"),className:"text-white/50 hover:text-white transition-colors p-2 -m-2",children:e.jsx(xe,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsxs("div",{className:"text-white font-bold text-sm sm:text-base",children:[w+1,"/",l.length]}),M>=2&&e.jsxs(m.div,{initial:{scale:0},animate:{scale:1},className:"px-2 sm:px-3 py-1 bg-gradient-to-r from-orange-500 to-red-500 rounded-full text-white text-xs sm:text-sm font-bold flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3 sm:w-4 sm:h-4"}),M,"x"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-fuchsia-400",children:_.toLocaleString()}),e.jsx("button",{onClick:()=>ae(!X),className:"text-white/50 hover:text-white transition-colors p-1",children:X?e.jsx(pe,{className:"w-4 h-4"}):e.jsx(he,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"px-3 sm:px-4",children:[e.jsx("div",{className:"h-1.5 sm:h-2 bg-white/10 rounded-full overflow-hidden backdrop-blur-sm",children:e.jsx(m.div,{initial:{width:"100%"},animate:{width:`${j/k*100}%`},transition:{duration:.5},className:`h-full rounded-full ${j>10?"bg-gradient-to-r from-green-400 to-emerald-500":j>5?"bg-gradient-to-r from-yellow-400 to-orange-500":"bg-gradient-to-r from-red-500 to-pink-500"}`})}),e.jsx("div",{className:"text-center mt-1 sm:mt-2",children:e.jsxs("span",{className:`text-xl sm:text-2xl font-bold ${j>10?"text-green-400":j>5?"text-yellow-400":"text-red-400 animate-pulse"}`,children:[j,"s"]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col justify-center p-3 sm:p-4",children:[e.jsx(J,{mode:"wait",children:e.jsxs(m.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},className:"mb-4 sm:mb-8",children:[e.jsxs("div",{className:"text-center mb-3 sm:mb-4 flex flex-wrap items-center justify-center gap-2",children:[e.jsx("span",{className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-white/10 backdrop-blur-md rounded-full text-cyan-400 text-xs sm:text-sm font-medium",children:x==null?void 0:x.category}),(x==null?void 0:x.difficulty)==="hard"&&e.jsx("span",{className:"px-2 sm:px-3 py-1 bg-red-500/20 backdrop-blur-md rounded-full text-red-400 text-xs font-bold",children:"DIFFICILE"})]}),e.jsx("h2",{className:"text-lg sm:text-2xl md:text-3xl font-bold text-white text-center leading-tight px-2",children:x==null?void 0:x.question})]},w)}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4 max-w-2xl mx-auto w-full",children:x==null?void 0:x.answers.map((i,o)=>{const N=P===o,v=o===x.correct,u=y&&v,C=y&&N&&!v;return e.jsx(m.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:o*.1},whileHover:y?{}:{scale:1.02},whileTap:y?{}:{scale:.98},onClick:()=>Q(o),disabled:y,className:`p-3 sm:p-4 md:p-6 rounded-xl sm:rounded-2xl text-left font-semibold text-sm sm:text-base md:text-lg transition-all duration-300 backdrop-blur-md touch-manipulation ${u?"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-lg shadow-green-500/50":C?"bg-gradient-to-r from-red-500 to-pink-500 text-white shadow-lg shadow-red-500/50":N?"bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white":"bg-white/10 text-white hover:bg-white/20 active:bg-white/30 border border-white/10"}`,children:e.jsxs("span",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("span",{className:`w-6 h-6 sm:w-8 sm:h-8 rounded-full flex items-center justify-center text-xs sm:text-sm font-bold flex-shrink-0 ${u||C?"bg-white/20":"bg-white/10"}`,children:String.fromCharCode(65+o)}),e.jsx("span",{className:"line-clamp-2",children:i})]})},o)})}),e.jsx(J,{children:y&&e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0},className:"text-center mt-4 sm:mt-8",children:P===(x==null?void 0:x.correct)?e.jsxs("div",{className:"text-green-400 font-bold text-lg sm:text-xl",children:["+",Math.floor((x.points+j*10)*I)," points"]}):e.jsx("div",{className:"text-red-400 font-bold text-lg sm:text-xl",children:"Mauvaise rÃ©ponse"})})})]}),I>1&&e.jsxs(m.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"fixed bottom-20 sm:bottom-4 right-4 px-3 sm:px-4 py-1.5 sm:py-2 bg-gradient-to-r from-orange-500 to-red-500 rounded-full text-white font-bold shadow-lg text-sm sm:text-base",children:["COMBO x",I.toFixed(1)]})]})]})}export{Pe as default};
